{"version":3,"sources":["../../../../../src/Apps/Collect2/Routes/Collection/index.tsx"],"names":["CollectionApp","props","context_module","Schema","ContextModule","CollectionDescription","context_page_owner_slug","viewer","slug","context_page_owner_id","id","collection","HttpError","collectionNotFound","location","relay","title","headerImage","description","artworks","collectionHref","sd","APP_URL","metadataDescription","text","showCollectionHubs","linkedCollections","length","path","name","query","value","aggregations","updateUrl","key","filterState","tracking","trackEvent","action_type","ActionType","CommercialFilterParamsChanged","changed","current","relatedCollections","Component","CollectionAppQuery","CollectionRefetchContainer"],"mappings":"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","sourcesContent":["import { Box, Separator } from \"@artsy/palette\"\nimport { Collection_viewer } from \"__generated__/Collection_viewer.graphql\"\nimport { SeoProductsForArtworks } from \"Apps/Collect2/Components/SeoProductsForArtworks\"\nimport { CollectionFilterFragmentContainer as CollectionHeader } from \"Apps/Collect2/Routes/Collection/Components/Header\"\nimport { AppContainer } from \"Apps/Components/AppContainer\"\nimport { track } from \"Artsy/Analytics\"\nimport * as Schema from \"Artsy/Analytics/Schema\"\nimport { SystemContextProps, withSystemContext } from \"Artsy/SystemContext\"\nimport { FrameWithRecentlyViewed } from \"Components/FrameWithRecentlyViewed\"\nimport { RelatedCollectionsRailFragmentContainer as RelatedCollectionsRail } from \"Components/RelatedCollectionsRail/RelatedCollectionsRail\"\nimport { BreadCrumbList } from \"Components/v2/Seo\"\nimport { Location } from \"found\"\nimport { HttpError } from \"found\"\nimport React, { Component } from \"react\"\nimport { Link, Meta, Title } from \"react-head\"\nimport { createRefetchContainer, graphql, RelayRefetchProp } from \"react-relay\"\nimport { data as sd } from \"sharify\"\nimport truncate from \"trunc-html\"\nimport { CollectionsHubRailsContainer as CollectionsHubRails } from \"./Components/CollectionsHubRails\"\n\nimport { BaseArtworkFilter } from \"Components/v2/ArtworkFilter\"\nimport {\n  ArtworkFilterContextProvider,\n  SharedArtworkFilterContextProps,\n} from \"Components/v2/ArtworkFilter/ArtworkFilterContext\"\nimport { updateUrl } from \"Components/v2/ArtworkFilter/Utils/urlBuilder\"\nimport { TrackingProp } from \"react-tracking\"\n\ninterface CollectionAppProps extends SystemContextProps {\n  viewer: Collection_viewer\n  location: Location\n  relay: RelayRefetchProp\n  tracking: TrackingProp\n}\n\n@track<CollectionAppProps>(props => ({\n  context_module: Schema.ContextModule.CollectionDescription,\n  context_page_owner_slug: props.viewer && props.viewer.slug,\n  context_page_owner_id: props.viewer && props.viewer.id,\n}))\nexport class CollectionApp extends Component<CollectionAppProps> {\n  collectionNotFound = collection => {\n    if (!collection) {\n      throw new HttpError(404)\n    }\n  }\n\n  UNSAFE_componentWillMount() {\n    this.collectionNotFound(this.props.viewer)\n  }\n\n  render() {\n    const { viewer, location, relay } = this.props\n    const { title, slug, headerImage, description, artworks } = viewer\n    const collectionHref = `${sd.APP_URL}/collection/${slug}`\n\n    const metadataDescription = description\n      ? `Buy, bid, and inquire on ${title} on Artsy. ` +\n        truncate(description, 158).text\n      : `Buy, bid, and inquire on ${title} on Artsy.`\n\n    const showCollectionHubs = viewer.linkedCollections.length > 0\n\n    return (\n      <AppContainer>\n        <FrameWithRecentlyViewed>\n          <Title>{`${title} - For Sale on Artsy`}</Title>\n          <Meta name=\"description\" content={metadataDescription} />\n          <Meta property=\"og:url\" content={collectionHref} />\n          <Meta property=\"og:image\" content={headerImage} />\n          <Meta property=\"og:description\" content={metadataDescription} />\n          <Meta property=\"twitter:description\" content={metadataDescription} />\n          <Link rel=\"canonical\" href={collectionHref} />\n          <BreadCrumbList\n            items={[\n              { path: \"/collections\", name: \"Collections\" },\n              { path: `/collection/${slug}`, name: title },\n            ]}\n          />\n          {artworks && <SeoProductsForArtworks artworks={artworks} />}\n          <CollectionHeader\n            collection={viewer as any}\n            artworks={artworks as any}\n          />\n          {showCollectionHubs && (\n            <CollectionsHubRails linkedCollections={viewer.linkedCollections} />\n          )}\n          <Box>\n            <ArtworkFilterContextProvider\n              filters={location.query}\n              sortOptions={[\n                { value: \"-decayed_merch\", text: \"Default\" },\n                { value: \"sold,-has_price,-prices\", text: \"Price (desc.)\" },\n                { value: \"sold,-has_price,prices\", text: \"Price (asc.)\" },\n                { value: \"-partner_updated_at\", text: \"Recently updated\" },\n                { value: \"-published_at\", text: \"Recently added\" },\n                { value: \"-year\", text: \"Artwork year (desc.)\" },\n                { value: \"year\", text: \"Artwork year (asc.)\" },\n              ]}\n              aggregations={\n                viewer.artworks\n                  .aggregations as SharedArtworkFilterContextProps[\"aggregations\"]\n              }\n              onChange={updateUrl}\n              onFilterClick={(key, value, filterState) => {\n                this.props.tracking.trackEvent({\n                  action_type: Schema.ActionType.CommercialFilterParamsChanged,\n                  changed: { [key]: value },\n                  current: filterState,\n                })\n              }}\n            >\n              <BaseArtworkFilter\n                relay={relay}\n                viewer={viewer}\n                relayVariables={{\n                  slug: viewer.slug,\n                }}\n              />\n            </ArtworkFilterContextProvider>\n          </Box>\n          {viewer.linkedCollections.length === 0 && (\n            <>\n              <Separator mt={6} mb={3} />\n              <Box mt=\"3\">\n                <RelatedCollectionsRail\n                  collections={viewer.relatedCollections}\n                  title={viewer.title}\n                />\n              </Box>\n            </>\n          )}\n        </FrameWithRecentlyViewed>\n      </AppContainer>\n    )\n  }\n}\n\n// TODO: Add `@principalField` to below query\n// when KAWS returns a 404 in `errors` for non-existent collections.\n// Currently it doesn't send any errors so there isn't anything\n// for Metaphysics to propagate.\nexport const CollectionAppQuery = graphql`\n  query CollectionRefetch2Query(\n    $acquireable: Boolean\n    $aggregations: [ArtworkAggregation] = [\n      MERCHANDISABLE_ARTISTS\n      MEDIUM\n      MAJOR_PERIOD\n      TOTAL\n    ]\n    $at_auction: Boolean\n    $color: String\n    $for_sale: Boolean\n    $height: String\n    $inquireable_only: Boolean\n    $major_periods: [String]\n    $medium: String\n    $offerable: Boolean\n    $page: Int\n    $price_range: String\n    $sort: String\n    $slug: String!\n    $width: String\n  ) {\n    viewer: marketingCollection(slug: $slug) {\n      ...Collection_viewer\n        @arguments(\n          acquireable: $acquireable\n          aggregations: $aggregations\n          at_auction: $at_auction\n          color: $color\n          for_sale: $for_sale\n          height: $height\n          inquireable_only: $inquireable_only\n          major_periods: $major_periods\n          medium: $medium\n          offerable: $offerable\n          page: $page\n          price_range: $price_range\n          sort: $sort\n          width: $width\n        )\n    }\n  }\n`\n\nexport const CollectionRefetchContainer = createRefetchContainer(\n  withSystemContext(CollectionApp),\n  {\n    viewer: graphql`\n      fragment Collection_viewer on MarketingCollection\n        @argumentDefinitions(\n          acquireable: { type: \"Boolean\" }\n          aggregations: { type: \"[ArtworkAggregation]\" }\n          at_auction: { type: \"Boolean\" }\n          color: { type: \"String\" }\n          for_sale: { type: \"Boolean\" }\n          height: { type: \"String\" }\n          inquireable_only: { type: \"Boolean\" }\n          major_periods: { type: \"[String]\" }\n          medium: { type: \"String\", defaultValue: \"*\" }\n          offerable: { type: \"Boolean\" }\n          page: { type: \"Int\" }\n          price_range: { type: \"String\" }\n          sort: { type: \"String\", defaultValue: \"-partner_updated_at\" }\n          width: { type: \"String\" }\n        ) {\n        category\n        credit\n        description\n        headerImage\n        id\n        slug\n        title\n        featuredArtistExclusionIds\n\n        query {\n          artist_ids\n          artist_id\n          gene_id\n        }\n\n        relatedCollections {\n          ...RelatedCollectionsRail_collections\n        }\n\n        linkedCollections {\n          ...CollectionsHubRails_linkedCollections\n        }\n\n        artworks(\n          aggregations: $aggregations\n          include_medium_filter_in_aggregation: true\n          size: 20\n          sort: \"-decayed_merch\"\n        ) {\n          ...Header_artworks\n          ...SeoProductsForArtworks_artworks\n\n          aggregations {\n            slice\n            counts {\n              id\n              name\n              count\n            }\n          }\n        }\n\n        filtered_artworks: artworks(\n          acquireable: $acquireable\n          aggregations: $aggregations\n          at_auction: $at_auction\n          color: $color\n          for_sale: $for_sale\n          height: $height\n          inquireable_only: $inquireable_only\n          major_periods: $major_periods\n          medium: $medium\n          offerable: $offerable\n          page: $page\n          price_range: $price_range\n          size: 0\n          sort: $sort\n          width: $width\n        ) {\n          __id\n          ...ArtworkFilterArtworkGrid2_filtered_artworks\n        }\n      }\n    `,\n  },\n  CollectionAppQuery\n)\n"],"file":"index.js"}