{"version":3,"sources":["../../../src/Apps/Order/OrderApp.tsx"],"names":["findRoute","routes","routeIndices","currentRoute","slice","forEach","routeIndex","children","OrderApp","stripe","newLocation","props","oldLocation","location","router","route","onTransition","removeTransitionHook","addTransitionHook","artwork","order","lineItems","edges","node","mediator","trigger","is_offerable","is_acquireable","window","Stripe","setState","sd","STRIPE_PUBLISHABLE_KEY","document","querySelector","addEventListener","artworkId","id","isEigen","state","mode","React","Component","SafeAreaContainer","Box"],"mappings":"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","sourcesContent":["import { Box } from \"@artsy/palette\"\nimport { OrderApp_order } from \"__generated__/OrderApp_order.graphql\"\nimport { AppContainer } from \"Apps/Components/AppContainer\"\nimport { StickyFooter } from \"Apps/Order/Components/StickyFooter\"\nimport { Mediator, SystemContextConsumer } from \"Artsy\"\nimport { ErrorPage } from \"Components/ErrorPage\"\nimport { Location, RouteConfig, Router } from \"found\"\nimport React from \"react\"\nimport { Meta, Title } from \"react-head\"\nimport { graphql } from \"react-relay\"\nimport { Elements, StripeProvider } from \"react-stripe-elements\"\nimport styled from \"styled-components\"\nimport { get } from \"Utils/get\"\nimport { ConnectedModalDialog } from \"./Dialogs\"\n\ndeclare global {\n  interface Window {\n    Stripe?: (key: string) => stripe.Stripe\n    sd: {\n      STRIPE_PUBLISHABLE_KEY: string\n    }\n  }\n}\n\nconst findRoute = (routes, routeIndices) => {\n  let currentRoute = routes[routeIndices[0]]\n  routeIndices.slice(1).forEach(routeIndex => {\n    currentRoute = currentRoute.children[routeIndex]\n  })\n  return currentRoute\n}\n\nexport interface OrderAppProps {\n  params: {\n    orderID: string\n  }\n  location: Location\n  routeIndices: number[]\n  routes: RouteConfig[]\n  router: Router\n  order: OrderApp_order\n}\n\ninterface OrderAppState {\n  stripe: stripe.Stripe\n}\n\nexport class OrderApp extends React.Component<OrderAppProps, OrderAppState> {\n  mediator: Mediator | null = null\n  state = { stripe: null }\n  removeTransitionHook: () => void\n\n  componentDidMount() {\n    if (!this.removeTransitionHook) {\n      this.removeTransitionHook = this.props.router.addTransitionHook(\n        this.onTransition\n      )\n    }\n\n    const artwork = get(\n      null,\n      () => this.props.order.lineItems.edges[0].node.artwork\n    )\n\n    if (artwork && this.mediator && this.mediator.trigger) {\n      const { is_offerable, is_acquireable } = artwork\n      this.mediator.trigger(\"enableIntercomForBuyers\", {\n        is_offerable,\n        is_acquireable,\n      })\n    }\n\n    if (window.Stripe) {\n      this.setState({\n        stripe: window.Stripe(window.sd.STRIPE_PUBLISHABLE_KEY),\n      })\n    } else {\n      document.querySelector(\"#stripe-js\").addEventListener(\"load\", () => {\n        // Create Stripe instance once Stripe.js loads\n        this.setState({\n          stripe: window.Stripe(window.sd.STRIPE_PUBLISHABLE_KEY),\n        })\n      })\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.removeTransitionHook) {\n      this.removeTransitionHook()\n    }\n  }\n\n  onTransition = newLocation => {\n    const { routes, routeIndices, location: oldLocation, router } = this.props\n    const route = findRoute(routes, routeIndices)\n\n    if (route.onTransition) {\n      return route.onTransition(newLocation, oldLocation, router)\n    }\n\n    return true\n  }\n\n  render() {\n    const { children, order } = this.props\n    let artworkId\n\n    if (!order) {\n      return <ErrorPage code={404} />\n    } else {\n      artworkId = get(\n        this.props,\n        props => order.lineItems.edges[0].node.artwork.id\n      )\n    }\n\n    return (\n      <SystemContextConsumer>\n        {({ isEigen, mediator }) => {\n          this.mediator = mediator\n          return (\n            <AppContainer>\n              <Title>Checkout | Artsy</Title>\n              {isEigen ? (\n                <Meta\n                  name=\"viewport\"\n                  content=\"width=device-width, user-scalable=no\"\n                />\n              ) : (\n                <Meta\n                  name=\"viewport\"\n                  content=\"width=device-width, initial-scale=1, maximum-scale=5 viewport-fit=cover\"\n                />\n              )}\n              <SafeAreaContainer>\n                <StripeProvider stripe={this.state.stripe}>\n                  <Elements>\n                    <>{children}</>\n                  </Elements>\n                </StripeProvider>\n              </SafeAreaContainer>\n              <StickyFooter orderType={order.mode} artworkId={artworkId} />\n              <ConnectedModalDialog />\n            </AppContainer>\n          )\n        }}\n      </SystemContextConsumer>\n    )\n  }\n}\n\nconst SafeAreaContainer = styled(Box)`\n  padding: env(safe-area-inset-top) env(safe-area-inset-right)\n    env(safe-area-inset-bottom) env(safe-area-inset-left);\n  margin-bottom: 75px;\n`\n\ngraphql`\n  fragment OrderApp_order on CommerceOrder {\n    mode\n    lineItems {\n      edges {\n        node {\n          artwork {\n            id\n            is_acquireable\n            is_offerable\n          }\n        }\n      }\n    }\n  }\n`\n"],"file":"OrderApp.js"}