{"version":3,"sources":["../../../../../src/Apps/Order/Routes/Counter/index.tsx"],"names":["logger","CounterRoute","props","action_type","Schema","ActionType","SubmittedCounterOffer","order_id","order","id","submitPendingOffer","input","offerId","myLastOffer","orderOrError","commerceSubmitPendingOffer","error","handleSubmitError","onSuccessfulSubmit","dialog","showErrorDialog","router","push","bind","variables","commitMutation","mutation","code","title","message","isCommittingMutation","counterofferFlowSteps","pointerEvents","lastOffer","createdAt","stateExpiresAt","onChangeResponse","onSubmitButtonPressed","Component","CounterFragmentContainer"],"mappings":"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","sourcesContent":["import { Button, Col, Flex, Row, Spacer } from \"@artsy/palette\"\nimport { Counter_order } from \"__generated__/Counter_order.graphql\"\nimport { CounterSubmitMutation } from \"__generated__/CounterSubmitMutation.graphql\"\nimport { HorizontalPadding } from \"Apps/Components/HorizontalPadding\"\nimport { ArtworkSummaryItemFragmentContainer as ArtworkSummaryItem } from \"Apps/Order/Components/ArtworkSummaryItem\"\nimport { ConditionsOfSaleDisclaimer } from \"Apps/Order/Components/ConditionsOfSaleDisclaimer\"\nimport { CreditCardSummaryItemFragmentContainer as CreditCardSummaryItem } from \"Apps/Order/Components/CreditCardSummaryItem\"\nimport {\n  counterofferFlowSteps,\n  OrderStepper,\n} from \"Apps/Order/Components/OrderStepper\"\nimport { ShippingSummaryItemFragmentContainer as ShippingSummaryItem } from \"Apps/Order/Components/ShippingSummaryItem\"\nimport { TransactionDetailsSummaryItemFragmentContainer as TransactionDetailsSummaryItem } from \"Apps/Order/Components/TransactionDetailsSummaryItem\"\nimport { TwoColumnLayout } from \"Apps/Order/Components/TwoColumnLayout\"\nimport { Dialog, injectDialog } from \"Apps/Order/Dialogs\"\nimport {\n  CommitMutation,\n  injectCommitMutation,\n} from \"Apps/Order/Utils/commitMutation\"\nimport { trackPageViewWrapper } from \"Apps/Order/Utils/trackPageViewWrapper\"\nimport { track } from \"Artsy/Analytics\"\nimport * as Schema from \"Artsy/Analytics/Schema\"\nimport { CountdownTimer } from \"Components/v2/CountdownTimer\"\nimport { Router } from \"found\"\nimport React, { Component } from \"react\"\nimport { createFragmentContainer, graphql, RelayProp } from \"react-relay\"\nimport createLogger from \"Utils/logger\"\nimport { Media } from \"Utils/Responsive\"\n\nexport interface CounterProps {\n  order: Counter_order\n  relay?: RelayProp\n  router: Router\n  dialog: Dialog\n  commitMutation: CommitMutation\n  isCommittingMutation: boolean\n}\n\nconst logger = createLogger(\"Order/Routes/Counter/index.tsx\")\n\n@track()\nexport class CounterRoute extends Component<CounterProps> {\n  constructor(props: CounterProps) {\n    super(props)\n    this.onSuccessfulSubmit = this.onSuccessfulSubmit.bind(this)\n  }\n\n  submitPendingOffer(variables: CounterSubmitMutation[\"variables\"]) {\n    return this.props.commitMutation<CounterSubmitMutation>({\n      variables,\n      mutation: graphql`\n        mutation CounterSubmitMutation(\n          $input: CommerceSubmitPendingOfferInput!\n        ) {\n          commerceSubmitPendingOffer(input: $input) {\n            orderOrError {\n              ... on CommerceOrderWithMutationSuccess {\n                order {\n                  state\n                  ... on CommerceOfferOrder {\n                    awaitingResponseFrom\n                  }\n                }\n              }\n              ... on CommerceOrderWithMutationFailure {\n                error {\n                  type\n                  code\n                  data\n                }\n              }\n            }\n          }\n        }\n      `,\n    })\n  }\n\n  onSubmitButtonPressed = async () => {\n    try {\n      const {\n        commerceSubmitPendingOffer: { orderOrError },\n      } = await this.submitPendingOffer({\n        input: {\n          offerId: this.props.order.myLastOffer.id,\n        },\n      })\n\n      if (orderOrError.error) {\n        this.handleSubmitError(orderOrError.error)\n        return\n      }\n\n      this.onSuccessfulSubmit()\n    } catch (error) {\n      logger.error(error)\n      this.props.dialog.showErrorDialog()\n    }\n  }\n\n  handleSubmitError(error: { code: string }) {\n    logger.error(error)\n    if (error.code === \"insufficient_inventory\") {\n      this.props.dialog.showErrorDialog({\n        title: \"This work has already been sold.\",\n        message: \"Please contact orders@artsy.net with any questions.\",\n      })\n    } else {\n      this.props.dialog.showErrorDialog()\n    }\n  }\n\n  @track<CounterProps>(props => ({\n    action_type: Schema.ActionType.SubmittedCounterOffer,\n    order_id: props.order.id,\n  }))\n  onSuccessfulSubmit() {\n    this.props.router.push(`/orders/${this.props.order.id}/status`)\n  }\n\n  onChangeResponse = () => {\n    const { order } = this.props\n    this.props.router.push(`/orders/${order.id}/respond`)\n  }\n\n  render() {\n    const { order, isCommittingMutation } = this.props\n\n    return (\n      <>\n        <HorizontalPadding px={[0, 4]}>\n          <Row>\n            <Col>\n              <OrderStepper\n                currentStep=\"Review\"\n                steps={counterofferFlowSteps}\n              />\n            </Col>\n          </Row>\n        </HorizontalPadding>\n\n        <HorizontalPadding>\n          <TwoColumnLayout\n            Content={\n              <Flex\n                flexDirection=\"column\"\n                style={isCommittingMutation ? { pointerEvents: \"none\" } : {}}\n              >\n                <Flex flexDirection=\"column\">\n                  <CountdownTimer\n                    action=\"Respond\"\n                    note=\"Expired offers end the negotiation process permanently.\"\n                    countdownStart={order.lastOffer.createdAt}\n                    countdownEnd={order.stateExpiresAt}\n                  />\n                  <TransactionDetailsSummaryItem\n                    order={order}\n                    title=\"Your counteroffer\"\n                    onChange={this.onChangeResponse}\n                    offerContextPrice=\"LAST_OFFER\"\n                    showOfferNote={true}\n                  />\n                </Flex>\n                <Spacer mb={[2, 3]} />\n                <Flex flexDirection=\"column\" />\n                <Media greaterThan=\"xs\">\n                  <Button\n                    onClick={this.onSubmitButtonPressed}\n                    loading={isCommittingMutation}\n                    size=\"large\"\n                    width=\"100%\"\n                  >\n                    Submit\n                  </Button>\n                  <Spacer mb={2} />\n                  <ConditionsOfSaleDisclaimer textAlign=\"center\" />\n                </Media>\n              </Flex>\n            }\n            Sidebar={\n              <Flex flexDirection=\"column\">\n                <Flex flexDirection=\"column\">\n                  <ArtworkSummaryItem order={order} />\n                  <ShippingSummaryItem order={order} locked />\n                  <CreditCardSummaryItem order={order} locked />\n                </Flex>\n                <Media greaterThan=\"xs\">\n                  <Spacer mb={2} />\n                </Media>\n                <Spacer mb={[2, 3]} />\n                <Media at=\"xs\">\n                  <>\n                    <Button\n                      onClick={this.onSubmitButtonPressed}\n                      loading={isCommittingMutation}\n                      size=\"large\"\n                      width=\"100%\"\n                    >\n                      Submit\n                    </Button>\n                    <Spacer mb={2} />\n                    <ConditionsOfSaleDisclaimer />\n                  </>\n                </Media>\n              </Flex>\n            }\n          />\n        </HorizontalPadding>\n      </>\n    )\n  }\n}\n\nexport const CounterFragmentContainer = createFragmentContainer(\n  trackPageViewWrapper(injectCommitMutation(injectDialog(CounterRoute))),\n  {\n    order: graphql`\n      fragment Counter_order on CommerceOrder {\n        id\n        mode\n        state\n        itemsTotal(precision: 2)\n        totalListPrice(precision: 2)\n        stateExpiresAt\n        ... on CommerceOfferOrder {\n          lastOffer {\n            createdAt\n          }\n          myLastOffer {\n            id\n          }\n        }\n        lineItems {\n          edges {\n            node {\n              artwork {\n                id\n              }\n            }\n          }\n        }\n        ...TransactionDetailsSummaryItem_order\n        ...ArtworkSummaryItem_order\n        ...ShippingSummaryItem_order\n        ...CreditCardSummaryItem_order\n        ...OfferHistoryItem_order\n      }\n    `,\n  }\n)\n"],"file":"index.js"}