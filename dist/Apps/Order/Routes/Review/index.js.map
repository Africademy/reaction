{"version":3,"sources":["../../../../../src/Apps/Order/Routes/Review/index.tsx"],"names":["logger","ReviewRoute","props","action_type","order","mode","Schema","ActionType","SubmittedOrder","SubmittedOffer","order_id","id","products","product_id","lineItems","edges","node","artwork","_id","quantity","price","itemsTotal","stripe","router","push","window","Stripe","setState","sd","STRIPE_PUBLISHABLE_KEY","document","querySelector","addEventListener","setupIntentId","submitBuyOrder","commerceSubmitOrder","orderOrError","submitOffer","commerceSubmitOrderWithOffer","error","handleSubmitError","actionData","clientSecret","state","handleCardAction","then","result","dialog","showErrorDialog","title","message","onSubmit","handleCardSetup","setupIntent","commitMutation","variables","input","mutation","offerId","myLastOffer","confirmedSetupIntentId","code","artistId","routeToArtistPage","parsedData","JSON","parse","data","failure_message","decline_code","routeToArtworkPage","o","artists","artworkId","route","onTransition","location","assign","isCommittingMutation","offerFlowSteps","buyNowFlowSteps","onChangeOffer","onChangeShipping","onChangePayment","Component","ReviewFragmentContainer"],"mappings":"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","sourcesContent":["import { Button, Col, Flex, Join, Row, Spacer } from \"@artsy/palette\"\nimport { Review_order } from \"__generated__/Review_order.graphql\"\nimport { ReviewSubmitOfferOrderMutation } from \"__generated__/ReviewSubmitOfferOrderMutation.graphql\"\nimport { ReviewSubmitOrderMutation } from \"__generated__/ReviewSubmitOrderMutation.graphql\"\nimport { HorizontalPadding } from \"Apps/Components/HorizontalPadding\"\nimport { ArtworkSummaryItemFragmentContainer as ArtworkSummaryItem } from \"Apps/Order/Components/ArtworkSummaryItem\"\nimport { ConditionsOfSaleDisclaimer } from \"Apps/Order/Components/ConditionsOfSaleDisclaimer\"\nimport { ItemReviewFragmentContainer as ItemReview } from \"Apps/Order/Components/ItemReview\"\nimport {\n  buyNowFlowSteps,\n  offerFlowSteps,\n  OrderStepper,\n} from \"Apps/Order/Components/OrderStepper\"\nimport { ShippingSummaryItemFragmentContainer as ShippingSummaryItem } from \"Apps/Order/Components/ShippingSummaryItem\"\nimport { TransactionDetailsSummaryItemFragmentContainer as TransactionDetailsSummaryItem } from \"Apps/Order/Components/TransactionDetailsSummaryItem\"\nimport { Dialog, injectDialog } from \"Apps/Order/Dialogs\"\nimport {\n  CommitMutation,\n  injectCommitMutation,\n} from \"Apps/Order/Utils/commitMutation\"\nimport { trackPageViewWrapper } from \"Apps/Order/Utils/trackPageViewWrapper\"\nimport { track } from \"Artsy/Analytics\"\nimport * as Schema from \"Artsy/Analytics/Schema\"\nimport { RouteConfig, Router } from \"found\"\nimport React, { Component } from \"react\"\nimport { createFragmentContainer, graphql, RelayProp } from \"react-relay\"\nimport { data as sd } from \"sharify\"\nimport { get } from \"Utils/get\"\nimport createLogger from \"Utils/logger\"\nimport { Media } from \"Utils/Responsive\"\nimport { CreditCardSummaryItemFragmentContainer as CreditCardSummaryItem } from \"../../Components/CreditCardSummaryItem\"\nimport { OfferSummaryItemFragmentContainer as OfferSummaryItem } from \"../../Components/OfferSummaryItem\"\nimport { TwoColumnLayout } from \"../../Components/TwoColumnLayout\"\n\nexport interface ReviewProps {\n  order: Review_order\n  relay?: RelayProp\n  router: Router\n  route: RouteConfig\n  dialog: Dialog\n  commitMutation: CommitMutation\n  isCommittingMutation: boolean\n}\n\nexport interface ReviewState {\n  stripe: stripe.Stripe\n}\n\nconst logger = createLogger(\"Order/Routes/Review/index.tsx\")\n\n@track()\nexport class ReviewRoute extends Component<ReviewProps, ReviewState> {\n  state = { stripe: null }\n  componentDidMount() {\n    if (window.Stripe) {\n      this.setState({\n        stripe: window.Stripe(sd.STRIPE_PUBLISHABLE_KEY),\n      })\n    } else {\n      document.querySelector(\"#stripe-js\").addEventListener(\"load\", () => {\n        // Create Stripe instance once Stripe.js loads\n        this.setState({\n          stripe: window.Stripe(sd.STRIPE_PUBLISHABLE_KEY),\n        })\n      })\n    }\n  }\n\n  @track<ReviewProps>(props => ({\n    action_type:\n      props.order.mode === \"BUY\"\n        ? Schema.ActionType.SubmittedOrder\n        : Schema.ActionType.SubmittedOffer,\n    order_id: props.order.id,\n    products: [\n      {\n        product_id: props.order.lineItems.edges[0].node.artwork._id,\n        quantity: 1,\n        price: props.order.itemsTotal,\n      },\n    ],\n  }))\n  async onSubmit(setupIntentId?: null) {\n    try {\n      const orderOrError =\n        this.props.order.mode === \"BUY\"\n          ? (await this.submitBuyOrder()).commerceSubmitOrder.orderOrError\n          : (await this.submitOffer(setupIntentId)).commerceSubmitOrderWithOffer\n              .orderOrError\n\n      if (orderOrError.error) {\n        this.handleSubmitError(orderOrError.error)\n        return\n      } else if (\n        this.props.order.mode === \"BUY\" &&\n        orderOrError.actionData &&\n        orderOrError.actionData.clientSecret\n      ) {\n        this.state.stripe\n          .handleCardAction(orderOrError.actionData.clientSecret)\n          .then(result => {\n            if (result.error) {\n              this.props.dialog.showErrorDialog({\n                title: \"An error occurred\",\n                message: result.error.message,\n              })\n              return\n            } else {\n              this.onSubmit()\n            }\n          })\n      } else if (\n        this.props.order.mode === \"OFFER\" &&\n        orderOrError.actionData &&\n        orderOrError.actionData.clientSecret\n      ) {\n        this.state.stripe\n          .handleCardSetup(orderOrError.actionData.clientSecret)\n          .then(result => {\n            if (result.error) {\n              this.props.dialog.showErrorDialog({\n                title: \"An error occurred\",\n                message: result.error.message,\n              })\n              return\n            } else {\n              this.onSubmit(result.setupIntent.id)\n            }\n          })\n      } else {\n        this.props.router.push(`/orders/${this.props.order.id}/status`)\n      }\n    } catch (error) {\n      logger.error(error)\n      this.props.dialog.showErrorDialog()\n    }\n  }\n\n  submitBuyOrder() {\n    return this.props.commitMutation<ReviewSubmitOrderMutation>({\n      variables: {\n        input: {\n          id: this.props.order.id,\n        },\n      },\n      mutation: graphql`\n        mutation ReviewSubmitOrderMutation($input: CommerceSubmitOrderInput!) {\n          commerceSubmitOrder(input: $input) {\n            orderOrError {\n              ... on CommerceOrderWithMutationSuccess {\n                order {\n                  state\n                }\n              }\n              ... on CommerceOrderRequiresAction {\n                actionData {\n                  clientSecret\n                }\n              }\n              ... on CommerceOrderWithMutationFailure {\n                error {\n                  type\n                  code\n                  data\n                }\n              }\n            }\n          }\n        }\n      `,\n    })\n  }\n\n  submitOffer(setupIntentId: string | null) {\n    return this.props.commitMutation<ReviewSubmitOfferOrderMutation>({\n      variables: {\n        input: {\n          offerId: this.props.order.myLastOffer.id,\n          confirmedSetupIntentId: setupIntentId,\n        },\n      },\n      mutation: graphql`\n        mutation ReviewSubmitOfferOrderMutation(\n          $input: CommerceSubmitOrderWithOfferInput!\n        ) {\n          commerceSubmitOrderWithOffer(input: $input) {\n            orderOrError {\n              ... on CommerceOrderWithMutationSuccess {\n                order {\n                  state\n                }\n              }\n              ... on CommerceOrderRequiresAction {\n                actionData {\n                  clientSecret\n                }\n              }\n              ... on CommerceOrderWithMutationFailure {\n                error {\n                  type\n                  code\n                  data\n                }\n              }\n            }\n          }\n        }\n      `,\n    })\n  }\n\n  async handleSubmitError(error: { code: string; data: string }) {\n    logger.error(error)\n    switch (error.code) {\n      case \"missing_required_info\": {\n        this.props.dialog.showErrorDialog({\n          title: \"Missing information\",\n          message:\n            \"Please review and update your shipping and/or payment details and try again.\",\n        })\n        break\n      }\n      case \"insufficient_inventory\": {\n        await this.props.dialog.showErrorDialog({\n          title: \"Not available\",\n          message: \"Sorry, the work is no longer available.\",\n        })\n        const artistId = this.artistId()\n        if (artistId) {\n          this.routeToArtistPage()\n        }\n        break\n      }\n      case \"failed_charge_authorize\": {\n        const parsedData = JSON.parse(error.data)\n        this.props.dialog.showErrorDialog({\n          title: \"An error occurred\",\n          message: parsedData.failure_message,\n        })\n        break\n      }\n      case \"charge_authorization_failed\": {\n        let data = {} as any\n        if (error.data) {\n          data = JSON.parse(error.data)\n        }\n\n        if (data.decline_code === \"insufficient_funds\") {\n          await this.props.dialog.showErrorDialog({\n            title: \"Insufficient funds\",\n            message:\n              \"There aren't enough funds available on the payment methods you provided. Please contact your card provider or try another card.\",\n          })\n        } else {\n          await this.props.dialog.showErrorDialog({\n            title: \"Charge failed\",\n            message:\n              \"Payment authorization has been declined. Please contact your card provider and try again.\",\n          })\n        }\n        break\n      }\n      case \"payment_method_confirmation_failed\": {\n        await this.props.dialog.showErrorDialog({\n          title: \"Your card was declined\",\n          message:\n            \"We couldn't authorize your credit card. Please enter another payment method or contact your bank for more information.\",\n        })\n        break\n      }\n      case \"artwork_version_mismatch\": {\n        await this.props.dialog.showErrorDialog({\n          title: \"Work has been updated\",\n          message:\n            \"Something about the work changed since you started checkout. Please review the work before submitting your order.\",\n        })\n        this.routeToArtworkPage()\n        break\n      }\n      default: {\n        logger.error(error)\n        this.props.dialog.showErrorDialog()\n        break\n      }\n    }\n  }\n\n  artistId() {\n    return get(\n      this.props.order,\n      o => o.lineItems.edges[0].node.artwork.artists[0].id\n    )\n  }\n\n  routeToArtworkPage() {\n    const artworkId = get(\n      this.props.order,\n      o => o.lineItems.edges[0].node.artwork.id\n    )\n    // Don't confirm whether or not you want to leave the page\n    this.props.route.onTransition = () => null\n    window.location.assign(`/artwork/${artworkId}`)\n  }\n\n  routeToArtistPage() {\n    const artistId = this.artistId()\n\n    // Don't confirm whether or not you want to leave the page\n    this.props.route.onTransition = () => null\n    window.location.assign(`/artist/${artistId}`)\n  }\n\n  onChangeOffer = () => {\n    this.props.router.push(`/orders/${this.props.order.id}/offer`)\n  }\n\n  onChangePayment = () => {\n    this.props.router.push(`/orders/${this.props.order.id}/payment`)\n  }\n\n  onChangeShipping = () => {\n    this.props.router.push(`/orders/${this.props.order.id}/shipping`)\n  }\n\n  render() {\n    const { order, isCommittingMutation } = this.props\n\n    return (\n      <>\n        <HorizontalPadding px={[0, 4]}>\n          <Row>\n            <Col>\n              <OrderStepper\n                currentStep=\"Review\"\n                steps={\n                  order.mode === \"OFFER\" ? offerFlowSteps : buyNowFlowSteps\n                }\n              />\n            </Col>\n          </Row>\n        </HorizontalPadding>\n\n        <HorizontalPadding>\n          <TwoColumnLayout\n            Content={\n              <>\n                <Join separator={<Spacer mb={3} />}>\n                  <Flex flexDirection=\"column\" mb={[2, 3]}>\n                    {order.mode === \"OFFER\" && (\n                      <OfferSummaryItem\n                        order={order}\n                        onChange={this.onChangeOffer}\n                      />\n                    )}\n                    <ShippingSummaryItem\n                      order={order}\n                      onChange={this.onChangeShipping}\n                    />\n                    <CreditCardSummaryItem\n                      order={order}\n                      onChange={this.onChangePayment}\n                      title=\"Payment method\"\n                    />\n                  </Flex>\n                  <Media greaterThan=\"xs\">\n                    <ItemReview lineItem={order.lineItems.edges[0].node} />\n                    <Spacer mb={3} />\n                    <Button\n                      size=\"large\"\n                      width=\"100%\"\n                      loading={isCommittingMutation}\n                      onClick={() => this.onSubmit()}\n                    >\n                      Submit\n                    </Button>\n                    <Spacer mb={2} />\n                    <ConditionsOfSaleDisclaimer textAlign=\"center\" />\n                  </Media>\n                </Join>\n              </>\n            }\n            Sidebar={\n              <Flex flexDirection=\"column\">\n                <Flex flexDirection=\"column\">\n                  <ArtworkSummaryItem order={order} />\n                  <TransactionDetailsSummaryItem order={order} />\n                </Flex>\n                <Spacer mb={[2, 3]} />\n                <Media at=\"xs\">\n                  <Button\n                    size=\"large\"\n                    width=\"100%\"\n                    loading={isCommittingMutation}\n                    onClick={() => this.onSubmit()}\n                  >\n                    Submit\n                  </Button>\n                  <Spacer mb={2} />\n                  <ConditionsOfSaleDisclaimer />\n                </Media>\n              </Flex>\n            }\n          />\n        </HorizontalPadding>\n      </>\n    )\n  }\n}\n\nexport const ReviewFragmentContainer = createFragmentContainer(\n  trackPageViewWrapper(injectCommitMutation(injectDialog(ReviewRoute))),\n  {\n    order: graphql`\n      fragment Review_order on CommerceOrder {\n        id\n        mode\n        itemsTotal(precision: 2)\n        lineItems {\n          edges {\n            node {\n              ...ItemReview_lineItem\n              artwork {\n                id\n                _id\n                artists {\n                  id\n                }\n              }\n            }\n          }\n        }\n        ... on CommerceOfferOrder {\n          myLastOffer {\n            id\n          }\n        }\n        ...ArtworkSummaryItem_order\n        ...TransactionDetailsSummaryItem_order\n        ...ShippingSummaryItem_order\n        ...CreditCardSummaryItem_order\n        ...OfferSummaryItem_order\n      }\n    `,\n  }\n)\n"],"file":"index.js"}