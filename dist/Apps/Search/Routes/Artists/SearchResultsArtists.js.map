{"version":3,"sources":["../../../../../src/Apps/Search/Routes/Artists/SearchResultsArtists.tsx"],"names":["PAGE_SIZE","SearchResultsArtistsRoute","props","isLoading","page","setState","window","scrollTo","viewer","searchConnection","search","pageInfo","hasNextPage","endCursor","loadAfter","state","cursor","toggleLoading","relay","refetch","first","after","before","last","error","console","location","l","query","term","urlParams","qs","stringify","history","pushState","parseInt","artists","v","edges","map","e","node","artist","index","name","bio","imageUrl","href","_id","length","pageCursors","loadNext","renderArtists","React","Component","SearchResultsArtistsRouteFragmentContainer"],"mappings":"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","sourcesContent":["import { Box, Separator } from \"@artsy/palette\"\nimport { SearchResultsArtists_viewer } from \"__generated__/SearchResultsArtists_viewer.graphql\"\nimport { GenericSearchResultItem } from \"Apps/Search/Components/GenericSearchResultItem\"\nimport { ZeroState } from \"Apps/Search/Components/ZeroState\"\nimport { PaginationFragmentContainer as Pagination } from \"Components/v2\"\nimport { LoadingArea, LoadingAreaState } from \"Components/v2/LoadingArea\"\nimport { Location } from \"found\"\nimport qs from \"qs\"\nimport React from \"react\"\nimport { createRefetchContainer, graphql, RelayRefetchProp } from \"react-relay\"\nimport { get } from \"Utils/get\"\n\nexport interface Props {\n  viewer: SearchResultsArtists_viewer\n  relay: RelayRefetchProp\n  location: Location\n}\n\ninterface State extends LoadingAreaState {\n  page: number\n}\n\nconst PAGE_SIZE = 10\n\nexport class SearchResultsArtistsRoute extends React.Component<Props, State> {\n  state = {\n    isLoading: false,\n    page: null,\n  }\n\n  constructor(props) {\n    super(props)\n    const { location } = this.props\n    const { page } = get(location, l => l.query)\n\n    this.state = { isLoading: false, page: (page && parseInt(page, 10)) || 1 }\n  }\n\n  toggleLoading = isLoading => {\n    this.setState(\n      {\n        isLoading,\n      },\n      () => window.scrollTo(0, 0)\n    )\n  }\n\n  loadNext = () => {\n    const { viewer } = this.props\n    const { search: searchConnection } = viewer\n\n    const {\n      pageInfo: { hasNextPage, endCursor },\n    } = searchConnection\n\n    if (hasNextPage) {\n      this.loadAfter(endCursor, this.state.page + 1)\n    }\n  }\n\n  loadAfter = (cursor: string, page: number) => {\n    this.toggleLoading(true)\n\n    this.props.relay.refetch(\n      {\n        first: PAGE_SIZE,\n        after: cursor,\n        before: null,\n        last: null,\n        page: null,\n      },\n      null,\n      error => {\n        this.toggleLoading(false)\n        this.setState({ page })\n        if (error) {\n          console.error(error)\n        }\n\n        const { location } = this.props\n        const { term } = get(location, l => l.query)\n        const urlParams = qs.stringify({\n          term,\n          page,\n        })\n        // TODO: Look into using router push w/ query params.\n        // this.props.router.replace(`/search/artists?${urlParams}`)\n        window.history.pushState({}, null, `/search/artists?${urlParams}`)\n      }\n    )\n  }\n\n  renderArtists() {\n    const { viewer, location } = this.props\n    const { term } = get(location, l => l.query)\n    const { search: searchConnection } = viewer\n\n    const artists = get(viewer, v => v.search.edges, []).map(e => e.node)\n\n    return (\n      <>\n        {artists.map((artist, index) => {\n          return (\n            <Box key={index}>\n              <GenericSearchResultItem\n                name={artist.name}\n                description={artist.bio}\n                imageUrl={artist.imageUrl}\n                entityType=\"Artist\"\n                href={artist.href}\n                index={index}\n                term={term}\n                id={artist._id}\n              />\n              {index < artists.length - 1 && <Separator />}\n            </Box>\n          )\n        })}\n        <Pagination\n          pageCursors={searchConnection.pageCursors}\n          onClick={this.loadAfter}\n          onNext={this.loadNext}\n          scrollTo=\"#jumpto--searchResultTabs\"\n          hasNextPage={searchConnection.pageInfo.hasNextPage}\n        />\n      </>\n    )\n  }\n\n  render() {\n    const { viewer, location } = this.props\n    const { term } = get(location, l => l.query)\n\n    const artists = get(viewer, v => v.search.edges, []).map(e => e.node)\n    return (\n      <LoadingArea isLoading={this.state.isLoading}>\n        {artists.length === 0 ? (\n          <Box mt={3}>\n            <ZeroState term={term} />\n          </Box>\n        ) : (\n          this.renderArtists()\n        )}\n      </LoadingArea>\n    )\n  }\n}\n\nexport const SearchResultsArtistsRouteFragmentContainer = createRefetchContainer(\n  SearchResultsArtistsRoute,\n  {\n    viewer: graphql`\n      fragment SearchResultsArtists_viewer on Viewer\n        @argumentDefinitions(\n          term: { type: \"String!\", defaultValue: \"\" }\n          first: { type: \"Int\", defaultValue: 10 }\n          last: { type: \"Int\" }\n          after: { type: \"String\" }\n          before: { type: \"String\" }\n          page: { type: \"Int\" }\n        ) {\n        search(\n          query: $term\n          first: $first\n          after: $after\n          before: $before\n          last: $last\n          page: $page\n          entities: [ARTIST]\n        ) @principalField {\n          pageInfo {\n            hasNextPage\n            endCursor\n          }\n          pageCursors {\n            ...Pagination_pageCursors\n          }\n          edges {\n            node {\n              ... on Artist {\n                name\n                _id\n                href\n                imageUrl\n                bio\n              }\n            }\n          }\n        }\n      }\n    `,\n  },\n  graphql`\n    query SearchResultsArtistsQuery(\n      $first: Int\n      $last: Int\n      $after: String\n      $before: String\n      $term: String!\n      $page: Int\n    ) {\n      viewer {\n        ...SearchResultsArtists_viewer\n          @arguments(\n            first: $first\n            last: $last\n            after: $after\n            before: $before\n            term: $term\n            page: $page\n          )\n      }\n    }\n  `\n)\n"],"file":"SearchResultsArtists.js"}