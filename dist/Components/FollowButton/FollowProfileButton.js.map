{"version":3,"sources":["../../../src/Components/FollowButton/FollowProfileButton.tsx"],"names":["FollowProfileButton","props","tracking","is_followed","profile","trackingData","action","trackEvent","e","preventDefault","user","relay","onOpenAuthModal","id","environment","mutation","variables","input","profile_id","unfollow","optimisticResponse","followProfile","__id","trackFollow","contextModule","intent","copy","buttonProps","render","handleFollow","React","Component","FollowProfileButtonFragmentContainer","Artsy","withSystemContext"],"mappings":";;;;;;;;;;;;;;;;;;;AACA;;AAEA;;AACA;;AAEA;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAuBaA,mB;;;;;;;;;;;;;;;;;;kEAKG,YAAM;AAAA,wBAId,MAAKC,KAJS;AAAA,UAEhBC,QAFgB,eAEhBA,QAFgB;AAAA,UAGLC,WAHK,eAGhBC,OAHgB,CAGLD,WAHK;AAKlB,UAAME,YAAgC,GAAG,MAAKJ,KAAL,CAAWI,YAAX,IAA2B,EAApE;AACA,UAAMC,MAAM,GAAGH,WAAW,GAAG,oBAAH,GAA0B,kBAApD;AAEAD,MAAAA,QAAQ,CAACK,UAAT,CAAoB,sBAAO;AAAED,QAAAA,MAAM,EAANA;AAAF,OAAP,EAAmBD,YAAnB,CAApB;AACD,K;;mEAEc,UAAAG,CAAC,EAAI;AAClBA,MAAAA,CAAC,CAACC,cAAF,GADkB,CACC;;AADD,yBAEgC,MAAKR,KAFrC;AAAA,UAEVG,OAFU,gBAEVA,OAFU;AAAA,UAEDM,IAFC,gBAEDA,IAFC;AAAA,UAEKC,KAFL,gBAEKA,KAFL;AAAA,UAEYC,eAFZ,gBAEYA,eAFZ;;AAIlB,UAAIF,IAAI,IAAIA,IAAI,CAACG,EAAjB,EAAqB;AACnB,wCAA4CF,KAAK,CAACG,WAAlD,EAA+D;AAC7DC,UAAAA,QAAQ;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,YADqD;AAW7DC,UAAAA,SAAS,EAAE;AACTC,YAAAA,KAAK,EAAE;AACLC,cAAAA,UAAU,EAAEd,OAAO,CAACS,EADf;AAELM,cAAAA,QAAQ,EAAEf,OAAO,CAACD;AAFb;AADE,WAXkD;AAiB7DiB,UAAAA,kBAAkB,EAAE;AAClBC,YAAAA,aAAa,EAAE;AACbjB,cAAAA,OAAO,EAAE;AACPkB,gBAAAA,IAAI,EAAElB,OAAO,CAACkB,IADP;AAEPnB,gBAAAA,WAAW,EAAE,CAACC,OAAO,CAACD;AAFf;AADI;AADG;AAjByC,SAA/D;;AA0BA,cAAKoB,WAAL;AACD,OA5BD,MA4BO;AACLX,QAAAA,eAAe,IACbA,eAAe,CAAC,UAAD,EAAa;AAC1BY,UAAAA,aAAa,EAAE,gBADW;AAE1BC,UAAAA,MAAM,EAAE,gBAFkB;AAG1BC,UAAAA,IAAI,EAAE;AAHoB,SAAb,CADjB;AAMD;AACF,K;;;;;;;6BAEQ;AAAA,yBACkC,KAAKzB,KADvC;AAAA,UACCG,OADD,gBACCA,OADD;AAAA,UACUuB,WADV,gBACUA,WADV;AAAA,UACuBC,MADvB,gBACuBA,MADvB,EAGP;;AACA,UAAIA,MAAJ,EAAY;AACV,eAAO;AAAM,UAAA,OAAO,EAAE,KAAKC;AAApB,WAAmCD,MAAM,CAACxB,OAAD,CAAzC,CAAP;AACD,OAFD,MAEO;AACL,eACE,6BAAC,oBAAD;AACE,UAAA,UAAU,EAAEA,OAAO,IAAIA,OAAO,CAACD,WADjC;AAEE,UAAA,YAAY,EAAE,KAAK0B,YAFrB;AAGE,UAAA,WAAW,EAAEF;AAHf,UADF;AAOD;AACF;;;;EAzEsCG,eAAMC,S;;;;gBAAlC/B,mB,kBACW;AACpB2B,EAAAA,WAAW,EAAE;AADO,C;;AA2EjB,IAAMK,oCAAoC,GAAG,4BAAM,EAAN,EAClD,yCAAwBC,KAAK,CAACC,iBAAN,CAAwBlC,mBAAxB,CAAxB,EAAsE;AACpEI,EAAAA,OAAO;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAD6D,CAAtE,CADkD,CAA7C","sourcesContent":["import { FollowProfileButtonMutation } from \"__generated__/FollowProfileButtonMutation.graphql\"\nimport * as Artsy from \"Artsy\"\nimport { extend } from \"lodash\"\nimport React from \"react\"\nimport track, { TrackingProp } from \"react-tracking\"\nimport { FollowProfileButton_profile } from \"../../__generated__/FollowProfileButton_profile.graphql\"\nimport { FollowButton } from \"./Button\"\nimport { FollowTrackingData } from \"./Typings\"\n\nimport { ButtonProps } from \"@artsy/palette\"\nimport {\n  commitMutation,\n  createFragmentContainer,\n  graphql,\n  RelayProp,\n} from \"react-relay\"\n\ninterface Props\n  extends React.HTMLProps<FollowProfileButton>,\n    Artsy.SystemContextProps {\n  relay?: RelayProp\n  profile?: FollowProfileButton_profile\n  tracking?: TrackingProp\n  trackingData?: FollowTrackingData\n  onOpenAuthModal?: (type: \"register\" | \"login\", config?: object) => void\n\n  buttonProps?: Partial<ButtonProps>\n  /**\n   * Custom renderer for alternative button displays\n   */\n  render?: (profile: FollowProfileButton_profile) => JSX.Element\n}\n\nexport class FollowProfileButton extends React.Component<Props> {\n  static defaultProps = {\n    buttonProps: {},\n  }\n\n  trackFollow = () => {\n    const {\n      tracking,\n      profile: { is_followed },\n    } = this.props\n    const trackingData: FollowTrackingData = this.props.trackingData || {}\n    const action = is_followed ? \"Unfollowed Profile\" : \"Followed Profile\"\n\n    tracking.trackEvent(extend({ action }, trackingData))\n  }\n\n  handleFollow = e => {\n    e.preventDefault() // If this button is part of a link, we _probably_ dont want to actually follow the link.\n    const { profile, user, relay, onOpenAuthModal } = this.props\n\n    if (user && user.id) {\n      commitMutation<FollowProfileButtonMutation>(relay.environment, {\n        mutation: graphql`\n          mutation FollowProfileButtonMutation($input: FollowProfileInput!) {\n            followProfile(input: $input) {\n              profile {\n                __id\n                is_followed\n              }\n            }\n          }\n        `,\n        variables: {\n          input: {\n            profile_id: profile.id,\n            unfollow: profile.is_followed,\n          },\n        },\n        optimisticResponse: {\n          followProfile: {\n            profile: {\n              __id: profile.__id,\n              is_followed: !profile.is_followed,\n            },\n          },\n        },\n      })\n      this.trackFollow()\n    } else {\n      onOpenAuthModal &&\n        onOpenAuthModal(\"register\", {\n          contextModule: \"intext tooltip\",\n          intent: \"follow profile\",\n          copy: \"Sign up to follow profile\",\n        })\n    }\n  }\n\n  render() {\n    const { profile, buttonProps, render } = this.props\n\n    // Custom button renderer\n    if (render) {\n      return <span onClick={this.handleFollow}>{render(profile)}</span>\n    } else {\n      return (\n        <FollowButton\n          isFollowed={profile && profile.is_followed}\n          handleFollow={this.handleFollow}\n          buttonProps={buttonProps}\n        />\n      )\n    }\n  }\n}\n\nexport const FollowProfileButtonFragmentContainer = track({})(\n  createFragmentContainer(Artsy.withSystemContext(FollowProfileButton), {\n    profile: graphql`\n      fragment FollowProfileButton_profile on Profile {\n        __id\n        id\n        is_followed\n      }\n    `,\n  })\n)\n"],"file":"FollowProfileButton.js"}