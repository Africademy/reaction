{"version":3,"sources":["../../../../src/Components/Publishing/ReadMore/ReadMoreWrapper.tsx"],"names":["ReadMoreWrapper","truncationHeight","props","isTruncated","setState","calculateTruncationHeight","height","charCount","thisNode","ReactDOM","findDOMNode","getElementsByClassName","section","sectionCharCount","tags","length","getElementsByTagName","foundTag","tag","textContent","textLength","getBoundingClientRect","bottom","top","hideButton","state","setTimeout","truncateArticle","window","addEventListener","removeEventListener","getTruncationHeight","overflow","getOverflow","children","React","Component"],"mappings":";;;;;;;;;;;;;;;;;;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;AAWA;;;;IAIaA,e;;;;;;;;;;;;;;;;;;4DAIH;AACNC,MAAAA,gBAAgB,EAAE;AADZ,K;;sEAaU,YAAM;AACtB,UAAI,MAAKC,KAAL,CAAWC,WAAf,EAA4B;AAC1B,cAAKC,QAAL,CAAc;AAAEH,UAAAA,gBAAgB,EAAE,MAAKI,yBAAL;AAApB,SAAd;AACD;AACF,K;;gFAE2B,YAAM;AAAA,UACxBF,WADwB,GACR,MAAKD,KADG,CACxBC,WADwB;;AAGhC,UAAIA,WAAJ,EAAiB;AACf,YAAIG,MAAM,GAAG,CAAb;AACA,YAAIC,SAAS,GAAG,CAAhB;;AACA,YAAMC,QAAQ,GAAGC,kBAASC,WAAT,+BAAjB,CAHe,CAKf;;;AACA,4BACEF,QAAQ,CAACG,sBAAT,CAAgC,uBAAhC,CADF,EAEE,UAAAC,OAAO,EAAI;AACT,cAAIC,gBAAgB,GAAG,CAAvB,CADS,CAGT;;AACA,cAAMC,IAAI,GAAGF,OAAO,CAACD,sBAAR,CAA+B,WAA/B,EAA4CI,MAA5C,GACTH,OAAO,CAACD,sBAAR,CAA+B,WAA/B,CADS,GAETC,OAAO,CAACI,oBAAR,CAA6B,GAA7B,CAFJ;AAIA,cAAMC,QAAQ,GAAG,oBAAKH,IAAL,EAAW,UAAAI,GAAG,EAAI;AACjC,gBAAMC,WAAW,GAAGD,GAAG,CAACC,WAAxB;AACA,gBAAMC,UAAU,GAAGD,WAAW,CAACJ,MAA/B,CAFiC,CAIjC;;AACAF,YAAAA,gBAAgB,GAAGA,gBAAgB,GAAGO,UAAtC;AACAb,YAAAA,SAAS,GAAGA,SAAS,GAAGa,UAAxB,CANiC,CAQjC;;AACA,gBAAID,WAAW,IAAIN,gBAAgB,GAAG,GAAlC,IAAyCN,SAAS,GAAG,IAAzD,EAA+D;AAC7DD,cAAAA,MAAM,GACJY,GAAG,CAACG,qBAAJ,GAA4BC,MAA5B,GACAd,QAAQ,CAACa,qBAAT,GAAiCE,GAFnC;AAGA,qBAAO,IAAP;AACD;;AACD,mBAAO,KAAP;AACD,WAhBgB,CAAjB;AAiBA,iBAAON,QAAQ,GAAG,IAAH,GAAU,KAAzB;AACD,SA5BH,EANe,CAqCf;;AACA,YAAIX,MAAJ,EAAY;AACV,iBAAOA,MAAP;AACD,SAFD,MAEO;AACL,gBAAKJ,KAAL,CAAWsB,UAAX;;AACA,iBAAO,MAAP;AACD;AACF,OA5CD,MA4CO;AACL,eAAO,MAAP;AACD;AACF,K;;0EAEqB,YAAM;AAC1B,aAAO,MAAKtB,KAAL,CAAWC,WAAX,GAAyB,MAAKsB,KAAL,CAAWxB,gBAApC,GAAuD,MAA9D;AACD,K;;kEAEa,YAAM;AAClB,aAAO,MAAKC,KAAL,CAAWC,WAAX,GAAyB,QAAzB,GAAoC,MAA3C;AACD,K;;;;;;;wCAzEmB;AAClBuB,MAAAA,UAAU,CAAC,KAAKC,eAAN,EAAuB,GAAvB,CAAV;AACAC,MAAAA,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkC,KAAKF,eAAvC;AACD;;;2CAEsB;AACrBC,MAAAA,MAAM,CAACE,mBAAP,CAA2B,QAA3B,EAAqC,KAAKH,eAA1C;AACD;;;6BAoEQ;AACP,aACE;AACE,QAAA,KAAK,EAAE;AACLrB,UAAAA,MAAM,EAAE,KAAKyB,mBAAL,EADH;AAELC,UAAAA,QAAQ,EAAE,KAAKC,WAAL;AAFL;AADT,SAMG,KAAK/B,KAAL,CAAWgC,QANd,CADF;AAUD;;;;EA9FkCC,eAAMC,S","sourcesContent":["import { find } from \"lodash\"\nimport React from \"react\"\nimport ReactDOM from \"react-dom\"\n\ninterface ReadMoreWrapperProps {\n  isTruncated: boolean\n  hideButton: () => void\n}\n\ninterface ReadMoreWrapperState {\n  truncationHeight: number | string\n}\n\n/**\n * @deprecated in favor of our Design System ReadMore component in @artsy/palette\n * https://palette.artsy.net/elements/layout/readmore\n */\nexport class ReadMoreWrapper extends React.Component<\n  ReadMoreWrapperProps,\n  ReadMoreWrapperState\n> {\n  state = {\n    truncationHeight: \"100%\",\n  }\n\n  componentDidMount() {\n    setTimeout(this.truncateArticle, 250)\n    window.addEventListener(\"resize\", this.truncateArticle)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.truncateArticle)\n  }\n\n  truncateArticle = () => {\n    if (this.props.isTruncated) {\n      this.setState({ truncationHeight: this.calculateTruncationHeight() })\n    }\n  }\n\n  calculateTruncationHeight = () => {\n    const { isTruncated } = this.props\n\n    if (isTruncated) {\n      let height = 0\n      let charCount = 0\n      const thisNode = ReactDOM.findDOMNode(this) as Element\n\n      // Iterate over text sections\n      find(\n        thisNode.getElementsByClassName(\"article__text-section\"),\n        section => {\n          let sectionCharCount = 0\n\n          // Iterate over paragraph tags\n          const tags = section.getElementsByClassName(\"paragraph\").length\n            ? section.getElementsByClassName(\"paragraph\")\n            : section.getElementsByTagName(\"p\")\n\n          const foundTag = find(tags, tag => {\n            const textContent = tag.textContent\n            const textLength = textContent.length\n\n            // Update counts\n            sectionCharCount = sectionCharCount + textLength\n            charCount = charCount + textLength\n\n            // Check if we've exceeded limits\n            if (textContent && sectionCharCount > 150 && charCount > 2000) {\n              height =\n                tag.getBoundingClientRect().bottom -\n                thisNode.getBoundingClientRect().top\n              return true\n            }\n            return false\n          })\n          return foundTag ? true : false\n        }\n      )\n\n      // Return found height or remove truncation if article is too short\n      if (height) {\n        return height\n      } else {\n        this.props.hideButton()\n        return \"100%\"\n      }\n    } else {\n      return \"100%\"\n    }\n  }\n\n  getTruncationHeight = () => {\n    return this.props.isTruncated ? this.state.truncationHeight : \"100%\"\n  }\n\n  getOverflow = () => {\n    return this.props.isTruncated ? \"hidden\" : \"auto\"\n  }\n\n  render() {\n    return (\n      <div\n        style={{\n          height: this.getTruncationHeight(),\n          overflow: this.getOverflow(),\n        }}\n      >\n        {this.props.children}\n      </div>\n    )\n  }\n}\n"],"file":"ReadMoreWrapper.js"}