{"version":3,"sources":["../../../../src/Components/Publishing/Sections/Sections.tsx"],"names":["MOBILE_DISPLAY_INJECT_INDEX","MOBILE_DISPLAY_INJECT_ID_PREFIX","Sections","shouldInjectMobileDisplay","props","article","layout","sections","firstText","findIndex","section","type","includes","lastText","isMobile","injectDisplayPanelMarker","setState","state","mountDisplayToMarker","prevProps","body","articleId","id","tag","updatedBody","split","map","p","reduce","arr","block","paragraphIndex","displayInjectId","concat","join","DisplayPanel","displayMountPoint","document","getElementById","ReactDOM","render","console","error","index","color","customWidth","showTooltips","targetHeight","size","width","fullscreenImages","image_collection","images","image_set","video","embed","social_embed","text","getContentStartIndex","getContentEndIndex","default","sectionComponent","indexAtFirstAd","AdUnit","Mobile_Feature_InContentLeaderboard1","Desktop_Feature_Leaderboard1","Mobile_Feature_InContentLeaderboard2","Desktop_Feature_Leaderboard2","Mobile_Feature_InContentLeaderboard3","Desktop_Feature_LeaderboardRepeat","shouldAddTopMargin","isSponsored","isSuper","isTruncatedAt","hideAds","quantityOfAdsRendered","firstAdInjected","placementCount","displayMarkerInjected","articleSections","slice","renderedSections","sectionItem","ad","shouldInject","shouldInjectNewAds","adDimension","AdDimension","Mobile_Sponsored_Feature_InContentLeaderboard1","Desktop_NewsLanding_Leaderboard1","marginTop","getAdMarginTop","getAdUnit","child","getSection","authors","postscript","Boolean","renderSections","renderAuthors","renderPostScript","Component","chooseMargin","StyledSections","styled","div","pMedia","xl","md","xs","AdWrapper","Box"],"mappings":"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","sourcesContent":["import { Box } from \"@artsy/palette\"\nimport { targetingData } from \"Components/Publishing/Display/DisplayTargeting\"\nimport { getSlideshowImagesFromArticle } from \"Components/Publishing/Layouts/ArticleWithFullScreen\"\nimport { AdDimension, AdUnit } from \"Components/Publishing/Typings\"\nimport { clone, compact, findLastIndex, get, once } from \"lodash\"\nimport React, { Component } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport styled from \"styled-components\"\nimport { pMedia } from \"../../Helpers\"\nimport { DisplayAd } from \"../Display/DisplayAd\"\nimport { ArticleData } from \"../Typings\"\nimport { Authors } from \"./Authors\"\nimport { Embed } from \"./Embed\"\nimport { ImageCollection } from \"./ImageCollection\"\nimport { ImageSetPreview } from \"./ImageSetPreview\"\nimport { SectionContainer } from \"./SectionContainer\"\nimport { SocialEmbed } from \"./SocialEmbed\"\nimport { Text } from \"./Text\"\nimport { Video } from \"./Video\"\n\ninterface Props {\n  DisplayPanel?: any\n  article: ArticleData\n  color?: string\n  isMobile?: boolean\n  showTooltips?: boolean\n  isSponsored?: boolean\n  isSuper?: boolean\n  customWidth?: number\n  isTruncatedAt?: number\n  hideAds?: boolean\n}\n\ninterface State {\n  shouldInjectMobileDisplay: boolean\n}\n\n/**\n * When isMobile, hide sidebar and inject DisplayAd into the body of the\n * article at a specific paragraph index.\n */\nconst MOBILE_DISPLAY_INJECT_INDEX = 1\nconst MOBILE_DISPLAY_INJECT_ID_PREFIX = \"__mobile_display_inject__\"\n\nexport class Sections extends Component<Props, State> {\n  static defaultProps = {\n    isMobile: false,\n  }\n\n  displayInjectId: string\n\n  state = {\n    shouldInjectMobileDisplay: false,\n  }\n\n  UNSAFE_componentWillMount() {\n    const {\n      article: { layout },\n      isMobile,\n    } = this.props\n\n    this.injectDisplayPanelMarker = once(this.injectDisplayPanelMarker)\n    const shouldInjectMobileDisplay = isMobile && layout !== \"feature\"\n\n    this.setState({\n      shouldInjectMobileDisplay,\n    })\n  }\n\n  componentDidMount() {\n    if (this.state.shouldInjectMobileDisplay) {\n      this.mountDisplayToMarker()\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const { isMobile } = this.props\n\n    if (prevProps.isMobile !== isMobile) {\n      this.setState(\n        {\n          shouldInjectMobileDisplay: isMobile,\n        },\n        () => {\n          if (isMobile && this.state.shouldInjectMobileDisplay) {\n            this.mountDisplayToMarker()\n          }\n        }\n      )\n    }\n  }\n\n  /**\n   * Inject DisplayAd after a specific paragraph index\n   */\n  injectDisplayPanelMarker(body) {\n    const articleId = this.props.article.id\n    const tag = \"</p>\"\n    const updatedBody = compact(body.split(tag))\n      .map(p => p + tag)\n      .reduce((arr, block, paragraphIndex) => {\n        if (paragraphIndex === MOBILE_DISPLAY_INJECT_INDEX) {\n          this.displayInjectId = `${MOBILE_DISPLAY_INJECT_ID_PREFIX}${articleId}`\n          return arr.concat([block, `<div id=\"${this.displayInjectId}\"></div>`])\n        } else {\n          return arr.concat([block])\n        }\n      }, [])\n      .join(\"\")\n\n    return updatedBody\n  }\n\n  mountDisplayToMarker() {\n    const { DisplayPanel } = this.props\n    const displayMountPoint = document.getElementById(this.displayInjectId)\n\n    if (displayMountPoint) {\n      ReactDOM.render(<DisplayPanel />, displayMountPoint)\n    } else {\n      console.error(\n        \"(reaction/Sections.tsx) Error mounting Display: DOM node \",\n        \"not found\",\n        displayMountPoint\n      )\n    }\n  }\n\n  getContentStartIndex = () => {\n    const {\n      article: { layout, sections },\n    } = this.props\n\n    if (layout === \"feature\") {\n      const firstText = sections.findIndex(section => {\n        return section.type === \"text\"\n      })\n      return firstText\n    }\n  }\n\n  getContentEndIndex = () => {\n    const {\n      article: { layout, sections },\n    } = this.props\n\n    if ([\"feature\", \"standard\"].includes(layout)) {\n      const lastText = findLastIndex(sections, section => {\n        return section.type === \"text\"\n      })\n      return lastText\n    }\n  }\n\n  getSection(section, index) {\n    const { article, color, customWidth, isMobile, showTooltips } = this.props\n    const targetHeight =\n      customWidth && (customWidth > 750 && !isMobile) ? 750 : 500\n    const size = customWidth && { width: customWidth }\n    const fullscreenImages = getSlideshowImagesFromArticle(article)\n\n    const sections = {\n      image_collection: (\n        <ImageCollection\n          color={color}\n          sectionLayout={section.layout}\n          articleLayout={article.layout}\n          images={section.images}\n          targetHeight={targetHeight}\n          gutter={10}\n          size={size}\n          fullscreenImages={fullscreenImages}\n        />\n      ),\n      image_set: (\n        <ImageSetPreview\n          section={section}\n          color={color}\n          fullscreenImages={fullscreenImages}\n        />\n      ),\n      video: <Video section={section} color={color} />,\n      embed: <Embed section={section} />,\n      social_embed: <SocialEmbed section={section} />,\n      text: (\n        <Text\n          color={color}\n          html={section.body}\n          layout={article.layout}\n          isContentStart={index === this.getContentStartIndex()}\n          isContentEnd={index === this.getContentEndIndex()}\n          showTooltips={showTooltips}\n        />\n      ),\n      default: false,\n    }\n\n    const sectionComponent = sections[section.type] || sections.default\n    return sectionComponent\n  }\n\n  getAdUnit(index: number, indexAtFirstAd: number) {\n    const { isMobile } = this.props\n\n    if (index === indexAtFirstAd) {\n      return isMobile\n        ? AdUnit.Mobile_Feature_InContentLeaderboard1\n        : AdUnit.Desktop_Feature_Leaderboard1\n    }\n\n    if (index === 6) {\n      return isMobile\n        ? AdUnit.Mobile_Feature_InContentLeaderboard2\n        : AdUnit.Desktop_Feature_Leaderboard2\n    }\n\n    return isMobile\n      ? AdUnit.Mobile_Feature_InContentLeaderboard3\n      : AdUnit.Desktop_Feature_LeaderboardRepeat\n  }\n\n  /**\n   * Add a margin top when to the ad when the section is any of the following:\n   * 1) Text section without <br> tags wrapping the <p> or <h2> content\n   * 3) Image set section\n   * 4) Image collection with a caption/title\n   */\n  getAdMarginTop(section) {\n    const shouldAddTopMargin = () => {\n      switch (section.type) {\n        case \"image_set\":\n          return true\n        case \"image_collection\":\n          get(section, [\"images\", \"[0]\", \"caption\"])\n          return true\n        case \"text\":\n          section.body.includes(\"<br>\")\n          return true\n        default:\n          return false\n      }\n    }\n\n    return shouldAddTopMargin() ? \"calc(100% - 96%)\" : null\n  }\n\n  renderSections() {\n    const {\n      article,\n      customWidth,\n      isMobile,\n      isSponsored,\n      isSuper,\n      isTruncatedAt,\n      hideAds,\n    } = this.props\n    const { shouldInjectMobileDisplay } = this.state\n    let quantityOfAdsRendered = 0\n    let firstAdInjected = false\n    let placementCount = 1\n    let displayMarkerInjected = false\n    let indexAtFirstAd = null\n\n    const articleSections = isTruncatedAt\n      ? clone(article.sections).slice(0, isTruncatedAt)\n      : article.sections\n\n    const renderedSections = articleSections.map((sectionItem, index) => {\n      let section = sectionItem\n      let ad = null\n      const shouldInject =\n        shouldInjectMobileDisplay &&\n        sectionItem.type === \"text\" &&\n        !displayMarkerInjected\n\n      /**\n       *  Possible data types for sectionItem.type are\n       *  callout, embed, social_embed, text, slideshow, image_set, and image_collection.\n       *  Here we want to inject the first ad after the first image_collection OR image_set data type.\n       * */\n      let shouldInjectNewAds =\n        article.layout === \"feature\" &&\n        (sectionItem.type === \"image_collection\" ||\n          sectionItem.type === \"image_set\") &&\n        !firstAdInjected &&\n        !isSuper &&\n        !hideAds\n\n      if (firstAdInjected) {\n        placementCount++\n      }\n\n      if (placementCount % 6 === 0 && quantityOfAdsRendered < 2) {\n        // only render 2 ads on Features\n        shouldInjectNewAds = true\n      }\n\n      if (shouldInjectNewAds) {\n        quantityOfAdsRendered++\n\n        const adDimension = isMobile\n          ? isSponsored\n            ? AdDimension.Mobile_Sponsored_Feature_InContentLeaderboard1\n            : AdDimension.Mobile_Feature_InContentLeaderboard1\n          : AdDimension.Desktop_NewsLanding_Leaderboard1\n\n        const marginTop = this.getAdMarginTop(section)\n\n        firstAdInjected = true\n        indexAtFirstAd = indexAtFirstAd === null ? index : indexAtFirstAd // only set this value once; after the index where 1st ad injection is found\n\n        ad = (\n          <AdWrapper mt={marginTop}>\n            <DisplayAd\n              adUnit={this.getAdUnit(placementCount, indexAtFirstAd)}\n              adDimension={adDimension}\n              targetingData={targetingData(\n                article,\n                isSponsored ? \"sponsorfeature\" : \"feature\"\n              )}\n            />\n          </AdWrapper>\n        )\n      }\n\n      if (shouldInject) {\n        try {\n          section = clone(sectionItem)\n          section.body = this.injectDisplayPanelMarker(section.body)\n          displayMarkerInjected = true\n        } catch (error) {\n          console.error(\n            \"(reaction/Sections.jsx) Error injecting Display:\",\n            error\n          )\n        }\n      }\n\n      const child = this.getSection(section, index)\n\n      if (child) {\n        return (\n          <SectionContainer\n            key={index}\n            articleLayout={article.layout}\n            section={section}\n            customWidth={customWidth}\n          >\n            {child}\n            {ad}\n          </SectionContainer>\n        )\n      }\n    })\n\n    return renderedSections\n  }\n\n  renderAuthors() {\n    const {\n      color,\n      article: { authors },\n    } = this.props\n\n    if (authors) {\n      return (\n        <SectionContainer>\n          <Authors authors={authors} color={color} />\n        </SectionContainer>\n      )\n    }\n  }\n\n  renderPostScript() {\n    const { article, color } = this.props\n    const { layout, postscript } = article\n\n    if (postscript) {\n      return (\n        <SectionContainer>\n          <Text\n            color={color}\n            html={postscript}\n            layout={layout}\n            postscript={Boolean(postscript)}\n          />\n        </SectionContainer>\n      )\n    }\n  }\n\n  render() {\n    const { article } = this.props\n\n    return (\n      <StyledSections layout={article.layout}>\n        {this.renderSections()}\n        {this.renderAuthors()}\n        {this.renderPostScript()}\n      </StyledSections>\n    )\n  }\n}\n\nconst chooseMargin = layout => {\n  if (layout === \"standard\") {\n    return \"0;\"\n  } else if (layout === \"feature\") {\n    return \"80px auto 0 auto;\"\n  }\n}\n\nexport const StyledSections = styled.div<{ layout: string }>`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n  margin: ${({ layout }) => chooseMargin(layout)};\n  max-width: ${({ layout }) => (layout === \"standard\" ? \"780px\" : \"auto\")};\n\n  ${({ layout }) => pMedia.xl`\n    max-width: ${layout === \"standard\" ? \"680px\" : \"auto\"};\n    ${layout === \"feature\" ? \"margin: 80px auto 0 auto\" : \"\"}\n  `}\n\n  ${({ layout }) => pMedia.md`\n    max-width: ${layout === \"standard\" ? \"780px\" : \"auto\"};\n  `}\n\n  ${({ layout }) => pMedia.xs`\n    max-width: ${layout === \"standard\" ? \"780px\" : \"auto\"};\n    ${layout === \"feature\" ? \"margin: 30px auto 0 auto\" : \"\"}\n  `}\n`\nconst AdWrapper = styled(Box)`\n  width: 100vw;\n  margin-left: calc(-50vw + 50%);\n`\n"],"file":"Sections.js"}