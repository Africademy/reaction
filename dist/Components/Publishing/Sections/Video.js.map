{"version":3,"sources":["../../../../src/Components/Publishing/Sections/Video.tsx"],"names":["BLACKLIST","QUERYSTRING","VIDEO_RATIO","VideoComponent","props","trackingData","dispatch","data","Events","postEvent","url","section","isValid","isValidVideoUrl","parsedUrl","urlParser","parse","playerUrl","getPlayerUrl","id","getId","playerSrc","state","src","hidden","console","error","playVideo","bind","tracking","trackEvent","action","label","setState","trackVideoClick","color","layout","caption","cover_image_url","width","size","showCaption","children","React","Component","x","urlExtension","split","pop","every","bad","hostname","indexOf","pathname","query","v","IFrame","styled","iframe","height","VideoContainer","div","p","breakpoint","md","xs","CoverImage","sizeMeOptions","refreshRate","SIZE_ME_REFRESH_RATE","noPlaceholder","Video"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport sizeMe from \"react-sizeme\"\nimport track, { TrackingProp } from \"react-tracking\"\nimport styled from \"styled-components\"\nimport urlParser from \"url\"\nimport Events from \"../../../Utils/Events\"\nimport { resize } from \"../../../Utils/resizer\"\nimport { pMedia as breakpoint } from \"../../Helpers\"\nimport { SIZE_ME_REFRESH_RATE } from \"../Constants\"\nimport { ArticleLayout } from \"../Typings\"\nimport { Caption } from \"./Caption\"\nimport { VideoControls } from \"./VideoControls\"\n\nconst BLACKLIST = [\"gif\", \"jpg\", \"jpeg\", \"png\"]\nconst QUERYSTRING =\n  \"?title=0&portrait=0&badge=0&byline=0&showinfo=0&rel=0&controls=2&modestbranding=1&iv_load_policy=3&color=E5E5E5\"\nexport const VIDEO_RATIO = 0.5625\n\ninterface VideoProps {\n  color?: string\n  section: {\n    url: string\n    caption?: string\n    cover_image_url?: string\n  }\n  size?: any\n  tracking?: TrackingProp\n  trackingData?: any\n  layout?: ArticleLayout\n}\n\ninterface VideoState {\n  src?: string // FIXME: Coming from Positron, this can be empty / invalid\n  hidden: boolean\n}\n\n@track(\n  props => {\n    return props.trackingData ? props.trackingData : {}\n  },\n  {\n    dispatch: data => Events.postEvent(data),\n  }\n)\nclass VideoComponent extends React.Component<VideoProps, VideoState> {\n  static defaultProps = {\n    size: {\n      width: 500,\n    },\n    tracking: {\n      trackEvent: x => x,\n    },\n  }\n\n  constructor(props) {\n    super(props)\n\n    const { url } = this.props.section\n    const isValid = url && isValidVideoUrl(url)\n\n    if (isValid) {\n      const parsedUrl = urlParser.parse(url, true)\n      const playerUrl = getPlayerUrl(parsedUrl)\n      const id = getId(parsedUrl)\n      const playerSrc = playerUrl + id + QUERYSTRING\n\n      this.state = {\n        src: playerSrc,\n        hidden: false,\n      }\n    } else {\n      console.error(\n        \"(@artsy/reaction) Video.tsx: A url is required for video.\",\n        this.props\n      )\n\n      this.state = {\n        hidden: true,\n      }\n    }\n    this.playVideo = this.playVideo.bind(this)\n  }\n\n  trackVideoClick() {\n    this.props.tracking.trackEvent({\n      action: \"Click\",\n      label: \"Play video\",\n    })\n  }\n\n  playVideo() {\n    const playerSrc = this.state.src + \"&autoplay=1\"\n    this.setState({ src: playerSrc, hidden: true })\n    this.trackVideoClick()\n  }\n\n  render() {\n    const {\n      color,\n      layout,\n      section: { caption, cover_image_url },\n      size: { width },\n    } = this.props\n    const showCaption = layout !== \"feature\"\n\n    return (\n      <VideoContainer layout={layout} className=\"VideoContainer\">\n        {cover_image_url && (\n          <CoverImage\n            className=\"VideoCover\"\n            src={resize(cover_image_url, { width: 1200 })}\n            height={width && width * VIDEO_RATIO}\n            onClick={this.playVideo}\n            hidden={this.state.hidden}\n          >\n            <VideoControls />\n          </CoverImage>\n        )}\n\n        <IFrame\n          src={this.state.src}\n          frameBorder=\"0\"\n          allowFullScreen\n          height={width && width * VIDEO_RATIO}\n        />\n\n        {showCaption && (\n          <Caption caption={caption} layout={layout} color={color}>\n            {this.props.children}\n          </Caption>\n        )}\n      </VideoContainer>\n    )\n  }\n}\n\n// Utils\nexport function isValidVideoUrl(url: string) {\n  const urlExtension = url && url.split(\".\").pop()\n  const isValid = BLACKLIST.every(bad => urlExtension !== bad)\n  return isValid\n}\n\nexport function getPlayerUrl(url) {\n  const { hostname } = url\n\n  if (hostname) {\n    if (hostname.indexOf(\"vimeo.com\") > -1) {\n      return \"https://player.vimeo.com/video/\"\n    } else if (hostname.indexOf(\"youtu\") > -1) {\n      return \"https://www.youtube.com/embed/\"\n    }\n  } else {\n    return \"\" // FIXME: check for errors\n  }\n}\n\nfunction getId(url) {\n  const { hostname, pathname } = url\n\n  if (hostname && pathname) {\n    if (url.hostname.indexOf(\"youtube.com\") > 0) {\n      return url.query.v\n    } else {\n      return url.pathname.split(\"/\").pop()\n    }\n  } else {\n    return \"\" // FIXME: error\n  }\n}\n\n// Styles\n\nexport const IFrame = styled.iframe`\n  width: 100%;\n  height: ${props => (props.height ? `${props.height}px` : \"100%\")};\n`\n\ninterface CoverImageProps {\n  src?: string\n  height?: number\n  layout?: ArticleLayout\n}\n\nconst VideoContainer = styled.div<CoverImageProps>`\n  width: 100%;\n  position: relative;\n\n  ${p => {\n    if (p.layout === \"feature\") {\n      return `\n        text-align: center;\n        padding-bottom: 53px;\n        max-width: 1200px;\n        margin: 0 auto;\n        ${breakpoint.md`\n          height: 450px;\n        `}\n\n        ${breakpoint.xs`\n          height: 300px;\n          padding-bottom: 20px;\n        `}\n      `\n    }\n  }};\n`\n\nexport const CoverImage = styled.div<CoverImageProps>`\n  display: ${props => (props.hidden || !props.src ? \"none\" : \"flex\")};\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: ${props => (props.height ? `${props.height}px` : \"100%\")};\n  position: absolute;\n  background: url(${props => props.src || \"\"}) no-repeat center center;\n  background-size: cover;\n  cursor: pointer;\n`\n\nconst sizeMeOptions = {\n  refreshRate: SIZE_ME_REFRESH_RATE,\n  noPlaceholder: true,\n}\n\nexport const Video = sizeMe(sizeMeOptions)(VideoComponent)\n"],"file":"Video.js"}