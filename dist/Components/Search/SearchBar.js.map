{"version":3,"sources":["../../../src/Components/Search/SearchBar.tsx"],"names":["logger","AutosuggestWrapper","Box","ResultsWrapper","colors","white","grayRegular","SuggestionContainer","children","containerProps","SearchBar","dispatch","data","Events","postEvent","_props","_state","query","hasResults","action_type","Schema","ActionType","SearchedAutosuggestWithResults","SearchedAutosuggestWithoutResults","FocusedOnAutosuggestInput","state","suggestion","node","href","displayType","id","suggestionIndex","SelectedItemFromSearch","term","destination_path","item_type","item_id","item_number","getSearchTerm","window","location","entityID","entityType","focused","setState","value","relay","props","performanceStart","performance","now","refetch","hasTerm","error","sd","VOLLEY_ENDPOINT","reportPerformanceMeasurement","viewer","edges","v","search","trackSearch","length","duration","deviceType","IS_MOBILE","metricPayload","type","name","timing","tags","request","post","send","serviceName","metrics","end","_e","newValue","event","isClickOnSearchIcon","relatedTarget","form","target","userClickedOnDescendant","e","noResults","p","displayLabel","edge","rest","renderer","isFirstItem","renderFirstSuggestion","renderDefaultSuggestion","item","isHighlighted","_term","_hasResults","throttledFetch","leading","throttledOnSuggestionHighlighted","assign","xs","inputProps","onChange","searchTextChanged","onFocus","bind","onBlur","placeholder","PLACEHOLDER_XS","PLACEHOLDER","onKeyDown","keyCode","preventDefault","firstSuggestionPlaceholder","suggestions","onSuggestionsClearRequested","getSuggestionValue","renderSuggestion","renderSuggestionsContainer","selection","onSuggestionSelected","renderInputComponent","renderAutosuggestComponent","Component","SearchBarRefetchContainer","SearchBarQueryRenderer","SystemContext","relayEnvironment","searchQuery","qs","querystring","parse","slice","Array","isArray"],"mappings":"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","sourcesContent":["import { Box, Flex } from \"@artsy/palette\"\nimport { SearchBar_viewer } from \"__generated__/SearchBar_viewer.graphql\"\nimport { SearchBarSuggestQuery } from \"__generated__/SearchBarSuggestQuery.graphql\"\nimport { SystemContext, SystemContextProps } from \"Artsy\"\nimport { track } from \"Artsy/Analytics\"\nimport * as Schema from \"Artsy/Analytics/Schema\"\nimport { SystemQueryRenderer as QueryRenderer } from \"Artsy/Relay/SystemQueryRenderer\"\nimport colors from \"Assets/Colors\"\nimport {\n  FirstSuggestionItem,\n  PLACEHOLDER,\n  PLACEHOLDER_XS,\n  SuggestionItem,\n} from \"Components/Search/Suggestions/SuggestionItem\"\nimport { isEmpty } from \"lodash\"\nimport { throttle } from \"lodash\"\nimport qs from \"qs\"\nimport React, { Component, useContext } from \"react\"\nimport Autosuggest from \"react-autosuggest\"\nimport { createRefetchContainer, graphql, RelayRefetchProp } from \"react-relay\"\nimport { data as sd } from \"sharify\"\nimport styled from \"styled-components\"\nimport request from \"superagent\"\nimport Events from \"Utils/Events\"\nimport { get } from \"Utils/get\"\nimport createLogger from \"Utils/logger\"\nimport { Media } from \"Utils/Responsive\"\nimport { SearchInputContainer } from \"./SearchInputContainer\"\n\nconst logger = createLogger(\"Components/Search/SearchBar\")\n\nexport interface Props extends SystemContextProps {\n  relay: RelayRefetchProp\n  viewer: SearchBar_viewer\n}\n\ninterface State {\n  /* Holds current input */\n  term: string\n  /* For preview generation of selected items */\n  entityID: string\n  entityType: string\n  focused: boolean\n}\n\nconst AutosuggestWrapper = styled(Box)`\n  position: relative;\n\n  ul {\n    list-style-type: none;\n    padding: 0;\n    margin: 0;\n  }\n`\n\nconst ResultsWrapper = styled(Box)`\n  background-color: ${colors.white};\n  display: flex;\n  border: 1px solid ${colors.grayRegular};\n  position: absolute;\n`\n\nconst SuggestionContainer = ({ children, containerProps }) => {\n  return (\n    <AutosuggestWrapper\n      width=\"100%\"\n      flexDirection={[\"column\", \"row\"]}\n      {...containerProps}\n    >\n      <ResultsWrapper width=\"100%\" mt={0.5}>\n        <Box width=\"100%\">\n          <Flex flexDirection=\"column\" width=\"100%\">\n            {children}\n          </Flex>\n        </Box>\n      </ResultsWrapper>\n    </AutosuggestWrapper>\n  )\n}\n\n@track(null, {\n  dispatch: data => Events.postEvent(data),\n})\nexport class SearchBar extends Component<Props, State> {\n  public input: HTMLInputElement\n\n  // Once this is set, we don't ever expect to change it back. A click on a\n  // descendant indicates that we're going to navigate away from the page, so\n  // this behaviour  is acceptable.\n  private userClickedOnDescendant: boolean\n\n  state = {\n    term: getSearchTerm(window.location),\n    entityID: null,\n    entityType: null,\n    focused: false,\n  }\n\n  // Throttled method to toggle previews.\n  throttledOnSuggestionHighlighted = ({ suggestion }) => {\n    if (!suggestion) return\n\n    const {\n      node: { displayType: entityType, id: entityID },\n    } = suggestion\n\n    if (entityType === \"FirstItem\") return\n\n    this.setState({\n      entityType,\n      entityID,\n    })\n  }\n\n  @track((_props, _state, [query, hasResults]) => ({\n    action_type: hasResults\n      ? Schema.ActionType.SearchedAutosuggestWithResults\n      : Schema.ActionType.SearchedAutosuggestWithoutResults,\n    query,\n  }))\n  trackSearch(_term, _hasResults) {\n    /* no-op */\n  }\n\n  // Throttled method to perform refetch for new suggest query.\n  throttledFetch = ({ value: term }) => {\n    const { relay } = this.props\n    const performanceStart = performance && performance.now()\n\n    relay.refetch(\n      {\n        term,\n        hasTerm: true,\n      },\n      null,\n      error => {\n        if (error) {\n          logger.error(error)\n          return\n        } else if (performanceStart && sd.VOLLEY_ENDPOINT) {\n          this.reportPerformanceMeasurement(performanceStart)\n        }\n        const { viewer } = this.props\n        const edges = get(viewer, v => v.search.edges, [])\n        this.trackSearch(term, edges.length > 0)\n      }\n    )\n  }\n\n  componentDidMount() {\n    this.throttledFetch = throttle(this.throttledFetch, 500, {\n      leading: true,\n    })\n    this.throttledOnSuggestionHighlighted = throttle(\n      this.throttledOnSuggestionHighlighted,\n      500,\n      { leading: true }\n    )\n  }\n\n  reportPerformanceMeasurement = performanceStart => {\n    const duration = performance.now() - performanceStart\n    const deviceType = sd.IS_MOBILE ? \"mobile\" : \"desktop\"\n\n    const metricPayload = {\n      type: \"timing\",\n      name: \"autocomplete-search-response\",\n      timing: duration,\n      tags: [`device-type:${deviceType}`, \"design:rich\"],\n    }\n\n    request\n      .post(sd.VOLLEY_ENDPOINT)\n      .send({\n        serviceName: \"force\",\n        metrics: [metricPayload],\n      })\n      .end()\n  }\n\n  searchTextChanged = (_e, { newValue: term }) => {\n    this.setState({ term })\n  }\n\n  @track({\n    action_type: Schema.ActionType.FocusedOnAutosuggestInput,\n  })\n  onFocus() {\n    this.setState({ focused: true })\n  }\n\n  onBlur = event => {\n    const isClickOnSearchIcon =\n      event.relatedTarget &&\n      event.relatedTarget.form &&\n      event.relatedTarget.form === event.target.form\n    if (isClickOnSearchIcon) {\n      if (!isEmpty(event.target.value)) {\n        this.userClickedOnDescendant = true\n      }\n    } else {\n      this.setState({ focused: false })\n    }\n  }\n\n  onSuggestionsClearRequested = e => {\n    // This event _also_ fires when a user clicks on a link in the preview pane\n    //  or the magnifying glass icon. If we initialize state when that happens,\n    //  the link will get removed from the DOM before the browser has a chance\n    //  to follow it.\n    if (!this.userClickedOnDescendant) {\n      this.setState({\n        entityID: null,\n        entityType: null,\n      })\n    }\n  }\n\n  // Navigate to selected search item.\n  @track(\n    (\n      _props,\n      state: State,\n      [\n        {\n          suggestion: {\n            node: { href, displayType, id },\n          },\n          suggestionIndex,\n        },\n      ]\n    ) => ({\n      action_type: Schema.ActionType.SelectedItemFromSearch,\n      query: state.term,\n      destination_path: href,\n      item_type: displayType,\n      item_id: id,\n      item_number: suggestionIndex,\n    })\n  )\n  onSuggestionSelected({\n    suggestion: {\n      node: { href },\n    },\n  }) {\n    this.userClickedOnDescendant = true\n\n    window.location.assign(href)\n  }\n\n  renderSuggestionsContainer = ({ containerProps, children, query }) => {\n    const noResults = get(this.props, p => p.viewer.search.edges.length === 0)\n    const { focused } = this.state\n\n    if (noResults || !focused || !query) {\n      return null\n    }\n\n    const props = {\n      children,\n      containerProps,\n      focused,\n      query,\n    }\n\n    return <SuggestionContainer {...props}>{children}</SuggestionContainer>\n  }\n\n  getSuggestionValue = ({ node: { displayLabel } }) => {\n    return displayLabel\n  }\n\n  renderSuggestion = (edge, rest) => {\n    const renderer = edge.node.isFirstItem\n      ? this.renderFirstSuggestion\n      : this.renderDefaultSuggestion\n    const item = renderer(edge, rest)\n    return item\n  }\n\n  renderFirstSuggestion = (edge, { query, isHighlighted }) => {\n    const { displayLabel, displayType, href } = edge.node\n    return (\n      <FirstSuggestionItem\n        display={displayLabel}\n        href={href}\n        isHighlighted={isHighlighted}\n        label={displayType}\n        query={query}\n      />\n    )\n  }\n\n  renderDefaultSuggestion = (edge, { query, isHighlighted }) => {\n    const { displayLabel, displayType, href } = edge.node\n    return (\n      <SuggestionItem\n        display={displayLabel}\n        href={href}\n        isHighlighted={isHighlighted}\n        label={displayType}\n        query={query}\n      />\n    )\n  }\n\n  renderInputComponent = props => <SearchInputContainer {...props} />\n\n  renderAutosuggestComponent({ xs }) {\n    const { term } = this.state\n    const { viewer } = this.props\n\n    const inputProps = {\n      onChange: this.searchTextChanged,\n      onFocus: this.onFocus.bind(this),\n      onBlur: this.onBlur,\n      placeholder: xs ? PLACEHOLDER_XS : PLACEHOLDER,\n      value: term,\n      name: \"term\",\n      onKeyDown: (event: React.KeyboardEvent<HTMLInputElement>) => {\n        if (\n          event.keyCode === 13 && // Enter key press ...\n          event.target && // with empty search query\n          isEmpty((event.target as HTMLInputElement).value)\n        ) {\n          event.preventDefault()\n        }\n      },\n    }\n\n    const firstSuggestionPlaceholder = {\n      node: {\n        isFirstItem: true,\n        displayType: \"FirstItem\",\n        displayLabel: term,\n        href: `/search?term=${term}`,\n      },\n    }\n\n    const edges = get(viewer, v => v.search.edges, [])\n    const suggestions = [firstSuggestionPlaceholder, ...edges]\n\n    return (\n      <Autosuggest\n        alwaysRenderSuggestions={this.userClickedOnDescendant}\n        suggestions={suggestions}\n        onSuggestionsClearRequested={this.onSuggestionsClearRequested}\n        onSuggestionHighlighted={this.throttledOnSuggestionHighlighted}\n        onSuggestionsFetchRequested={this.throttledFetch}\n        getSuggestionValue={this.getSuggestionValue}\n        renderSuggestion={this.renderSuggestion}\n        renderSuggestionsContainer={props => {\n          return this.renderSuggestionsContainer(props)\n        }}\n        inputProps={inputProps}\n        onSuggestionSelected={(e, selection) => {\n          e.preventDefault()\n          this.onSuggestionSelected(selection)\n        }}\n        renderInputComponent={this.renderInputComponent}\n      />\n    )\n  }\n\n  render() {\n    return (\n      <form\n        action=\"/search\"\n        method=\"GET\"\n        itemProp=\"potentialAction\"\n        itemScope\n        itemType=\"http://schema.org/SearchAction\"\n      >\n        <Media at=\"xs\">{this.renderAutosuggestComponent({ xs: true })}</Media>\n        <Media greaterThan=\"xs\">\n          {this.renderAutosuggestComponent({ xs: false })}\n        </Media>\n      </form>\n    )\n  }\n}\n\nexport const SearchBarRefetchContainer = createRefetchContainer(\n  (props: Props) => {\n    return <SearchBar {...props} />\n  },\n  {\n    viewer: graphql`\n      fragment SearchBar_viewer on Viewer\n        @argumentDefinitions(\n          term: { type: \"String!\", defaultValue: \"\" }\n          hasTerm: { type: \"Boolean!\", defaultValue: false }\n        ) {\n        search(query: $term, mode: AUTOSUGGEST, first: 7)\n          @include(if: $hasTerm) {\n          edges {\n            node {\n              displayLabel\n              href\n              ... on SearchableItem {\n                displayType\n                id\n              }\n            }\n          }\n        }\n      }\n    `,\n  },\n  graphql`\n    query SearchBarRefetchQuery($term: String!, $hasTerm: Boolean!) {\n      viewer {\n        ...SearchBar_viewer @arguments(term: $term, hasTerm: $hasTerm)\n      }\n    }\n  `\n)\n\nexport const SearchBarQueryRenderer: React.FC = () => {\n  const { relayEnvironment, searchQuery = \"\" } = useContext(SystemContext)\n  return (\n    <QueryRenderer<SearchBarSuggestQuery>\n      environment={relayEnvironment}\n      query={graphql`\n        query SearchBarSuggestQuery($term: String!, $hasTerm: Boolean!) {\n          viewer {\n            ...SearchBar_viewer @arguments(term: $term, hasTerm: $hasTerm)\n          }\n        }\n      `}\n      variables={{\n        term: \"\",\n        hasTerm: false,\n      }}\n      render={({ props }) => {\n        if (props) {\n          return <SearchBarRefetchContainer viewer={props.viewer} />\n          // SSR render pass. Since we don't have access to `<Boot>` context\n          // from within the NavBar (it's not a part of any app) we need to lean\n          // on styled-system for showing / hiding depending upon breakpoint.\n        } else {\n          return (\n            <>\n              <Box display={[\"block\", \"none\"]}>\n                <SearchInputContainer\n                  placeholder={searchQuery || PLACEHOLDER_XS}\n                  defaultValue={searchQuery}\n                />\n              </Box>\n              <Box display={[\"none\", \"block\"]}>\n                <SearchInputContainer\n                  placeholder={searchQuery || PLACEHOLDER}\n                  defaultValue={searchQuery}\n                />\n              </Box>\n            </>\n          )\n        }\n      }}\n    />\n  )\n}\n\nexport function getSearchTerm(location: Location): string {\n  const term = get(\n    qs,\n    querystring => querystring.parse(location.search.slice(1)).term,\n    \"\"\n  )\n  if (Array.isArray(term)) {\n    return term[0]\n  }\n  return term\n}\n"],"file":"SearchBar.js"}