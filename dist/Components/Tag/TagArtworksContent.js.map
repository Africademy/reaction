{"version":3,"sources":["../../../src/Components/Tag/TagArtworksContent.tsx"],"names":["SpinnerContainer","styled","div","PageSize","TagArtworksContent","loading","hasMore","props","filtered_artworks","artworks","pageInfo","hasNextPage","origLength","edges","length","state","finishedPaginatingWithError","setState","relay","loadMore","error","console","newLength","newHasMore","tagID","loadMoreArtworks","React","Component","direction","getConnectionFromProps","getFragmentVariables","prevVars","totalCount","count","getVariables","fragmentVariables","cursor","filteredArtworksNodeID","__id","query"],"mappings":"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","sourcesContent":["import { TagArtworksContent_filtered_artworks } from \"__generated__/TagArtworksContent_filtered_artworks.graphql\"\nimport ArtworkGrid from \"Components/ArtworkGrid\"\nimport React from \"react\"\nimport {\n  createPaginationContainer,\n  graphql,\n  RelayPaginationProp,\n} from \"react-relay\"\nimport styled from \"styled-components\"\nimport Spinner from \"../Spinner\"\n\nexport interface Props {\n  filtered_artworks: TagArtworksContent_filtered_artworks\n  relay: RelayPaginationProp\n  tagID: string\n}\n\nexport interface State {\n  loading: boolean\n}\n\nconst SpinnerContainer = styled.div`\n  width: 100%;\n  height: 100px;\n  position: relative;\n`\n\nconst PageSize = 10\n\nexport class TagArtworksContent extends React.Component<Props, State> {\n  private finishedPaginatingWithError = false\n\n  state = {\n    loading: false,\n  }\n\n  loadMoreArtworks() {\n    const hasMore = this.props.filtered_artworks.artworks.pageInfo.hasNextPage\n    const origLength = this.props.filtered_artworks.artworks.edges.length\n    if (hasMore && !this.state.loading && !this.finishedPaginatingWithError) {\n      this.setState({ loading: true }, () => {\n        this.props.relay.loadMore(PageSize, error => {\n          if (error) {\n            console.error(error)\n          }\n          const newLength = this.props.filtered_artworks.artworks.edges.length\n          const newHasMore = this.props.filtered_artworks.artworks.pageInfo\n            .hasNextPage\n          if (newLength - origLength < PageSize && newHasMore) {\n            console.error(\n              `Total count inconsistent with actual records returned for tag: ${\n                this.props.tagID\n              }`\n            )\n            this.finishedPaginatingWithError = true\n          }\n          this.setState({ loading: false })\n        })\n      })\n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <ArtworkGrid\n          artworks={this.props.filtered_artworks.artworks}\n          columnCount={4}\n          itemMargin={40}\n          onLoadMore={() => this.loadMoreArtworks()}\n        />\n        <SpinnerContainer>\n          {this.state.loading ? <Spinner /> : \"\"}\n        </SpinnerContainer>\n      </div>\n    )\n  }\n}\n\nexport default createPaginationContainer(\n  TagArtworksContent,\n  {\n    filtered_artworks: graphql`\n      fragment TagArtworksContent_filtered_artworks on FilterArtworks\n        @argumentDefinitions(\n          count: { type: \"Int\", defaultValue: 10 }\n          cursor: { type: \"String\", defaultValue: \"\" }\n        ) {\n        __id\n        artworks: artworks_connection(\n          first: $count\n          after: $cursor\n          sort: $sort\n        ) @connection(key: \"TagArtworksContent_filtered_artworks\") {\n          pageInfo {\n            hasNextPage\n            endCursor\n          }\n          ...ArtworkGrid_artworks\n          edges {\n            node {\n              __id\n            }\n          }\n        }\n      }\n    `,\n  },\n  {\n    direction: \"forward\",\n    getConnectionFromProps(props) {\n      return props.filtered_artworks.artworks\n    },\n    getFragmentVariables(prevVars, totalCount) {\n      return {\n        ...prevVars,\n        count: totalCount,\n      }\n    },\n    getVariables(props, { count, cursor }, fragmentVariables) {\n      return {\n        // in most cases, for variables other than connection filters like\n        // `first`, `after`, etc. you may want to use the previous values.\n        ...fragmentVariables,\n        count,\n        cursor,\n        filteredArtworksNodeID: props.filtered_artworks.__id,\n      }\n    },\n    query: graphql`\n      query TagArtworksContentQuery(\n        $filteredArtworksNodeID: ID!\n        $count: Int!\n        $cursor: String\n        $sort: String\n      ) {\n        node(__id: $filteredArtworksNodeID) {\n          ...TagArtworksContent_filtered_artworks\n            @arguments(count: $count, cursor: $cursor)\n        }\n      }\n    `,\n  }\n)\n"],"file":"TagArtworksContent.js"}