{"version":3,"sources":["../../../../src/Components/v2/Lightbox/Lightbox.tsx"],"names":["KEYBOARD_EVENT","ZOOM_PER_CLICK","HIDE_ZOOM_SLIDER_AFTER","DeepZoomContainer","styled","div","StyledImage","Image","LightboxComponent","context_module","Schema","ContextModule","Zoom","type","Type","Button","flow","Flow","ArtworkZoom","action_type","ActionType","Click","element","viewer","shown","activityTimer","showZoomSlider","deepZoomRef","React","createRef","slider","min","max","step","value","promisedDragon","setState","state","destroy","document","removeEventListener","handleKeyPress","clearTimeout","event","key","hide","setTimeout","amount","viewport","zoomBy","applyConstraints","then","OpenSeaDragon","current","debugMode","showNavigationControl","immediateRender","useCanvas","constrainDuringPan","blendTime","animationTime","springStiffness","maxZoomPixelRatio","minZoomImageRatio","zoomPerClick","zoomPerScroll","clickDistThreshold","clickTimeThreshold","visibilityRatio","tileSources","props","deepZoom","gestureSettingsTouch","scrolltozoom","clicktozoom","pinchtozoom","flickenabled","flickminspeed","flickmomentum","addEventListener","zoomTo","target","getMinZoom","getMaxZoom","getZoom","ReactDOM","createPortal","renderLightbox","addHandler","onZoomChanged","getHomeZoom","detectActivity","_event","getElementById","lightboxId","Promise","resolve","require","_prevProps","prevState","initSeaDragon","postRender","enter","exit","onSliderChanged","zoomIn","zoomOut","enabled","isDefault","imageAlt","src","initialHeight","user","height","isAdmin","cursor","renderPortal","show","bind","Component","Lightbox"],"mappings":"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","sourcesContent":["import { Box, color, Flex, Image, space } from \"@artsy/palette\"\nimport { withSystemContext } from \"Artsy\"\nimport * as Schema from \"Artsy/Analytics/Schema\"\nimport FadeTransition from \"Components/Animation/FadeTransition\"\nimport { bind, once, throttle } from \"lodash\"\nimport React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport track from \"react-tracking\"\nimport styled from \"styled-components\"\nimport { userIsAdmin } from \"Utils/user\"\nimport { CloseButton } from \"./CloseButton\"\nimport { Slider, SliderProps } from \"./LightboxSlider\"\n\nconst KEYBOARD_EVENT = \"keyup\"\nconst ZOOM_PER_CLICK = 1.4\nconst HIDE_ZOOM_SLIDER_AFTER = 2500\n\nconst DeepZoomContainer = styled.div`\n  position: fixed !important;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  z-index: 1000;\n  background-color: ${color(\"black100\")};\n`\n\nconst StyledImage = styled(Image)`\n  max-width: 100%;\n  max-height: 100%;\n`\n\nexport interface DeepZoomProps {\n  Image: {\n    xmlns: string\n    Url: string\n    Format: string\n    Overlap: number\n    TileSize: number\n    Size: {\n      Width: number\n      Height: number\n    }\n  }\n}\n\nexport interface LightboxProps {\n  imageAlt: string\n  deepZoom: DeepZoomProps\n  enabled?: boolean\n  isDefault?: boolean\n  src: string\n  initialHeight?: string\n\n  /**\n   * Id of the element to render the lightbox in\n   * Defaults to lightbox-container\n   */\n  lightboxId?: string\n\n  user?: User\n}\n\nexport interface LightboxState {\n  shown: boolean\n  element: Element\n  viewer: any\n  deepZoomRef: any\n  slider: SliderProps\n  showZoomSlider: boolean\n  promisedDragon: Promise<any>\n  activityTimer?: NodeJS.Timer\n}\n\n@track({ context_module: Schema.ContextModule.Zoom })\nclass LightboxComponent extends React.Component<LightboxProps, LightboxState> {\n  static defaultProps = {\n    enabled: true,\n    lightboxId: \"lightbox-container\",\n  }\n\n  state = {\n    element: null,\n    viewer: null,\n    shown: false,\n    activityTimer: null,\n    showZoomSlider: true,\n    deepZoomRef: React.createRef(),\n    slider: {\n      min: 0,\n      max: 1,\n      step: 0.001,\n      value: 0,\n    },\n    promisedDragon: null,\n  }\n\n  @track({\n    type: Schema.Type.Button,\n    flow: Schema.Flow.ArtworkZoom,\n    action_type: Schema.ActionType.Click,\n  })\n  show(_event) {\n    this.setState({ shown: true, showZoomSlider: true })\n  }\n\n  hide = () => {\n    this.setState({ shown: false })\n    if (this.state.viewer) {\n      this.state.viewer.destroy()\n      this.state.viewer = null\n    }\n    document.removeEventListener(KEYBOARD_EVENT, this.handleKeyPress)\n    clearTimeout(this.state.activityTimer)\n  }\n\n  handleKeyPress = event => {\n    if (event && event.key === \"Escape\") {\n      this.hide()\n    }\n  }\n\n  detectActivity = throttle(() => {\n    clearTimeout(this.state.activityTimer)\n    this.setState({\n      showZoomSlider: true,\n      activityTimer: setTimeout(() => {\n        this.setState({\n          showZoomSlider: false,\n        })\n      }, HIDE_ZOOM_SLIDER_AFTER),\n    })\n  }, 500) as () => void\n\n  zoomBy = amount => {\n    if (this.state.viewer.viewport) {\n      this.state.viewer.viewport.zoomBy(amount)\n      this.state.viewer.viewport.applyConstraints()\n    }\n  }\n\n  zoomIn = () => {\n    this.zoomBy(ZOOM_PER_CLICK)\n  }\n\n  zoomOut = () => {\n    this.zoomBy(1 / ZOOM_PER_CLICK)\n  }\n\n  initSeaDragon = () => {\n    this.state.promisedDragon.then(OpenSeaDragon => {\n      const viewer = OpenSeaDragon({\n        element: this.state.deepZoomRef.current,\n\n        debugMode: false,\n        showNavigationControl: false,\n        immediateRender: false,\n        useCanvas: true,\n        constrainDuringPan: false,\n        blendTime: 0.0,\n        animationTime: 1.5,\n        springStiffness: 15.0,\n        maxZoomPixelRatio: 1.0,\n        minZoomImageRatio: 0.9,\n        zoomPerClick: ZOOM_PER_CLICK,\n        zoomPerScroll: 1.4,\n        clickDistThreshold: 5,\n        clickTimeThreshold: 300,\n        visibilityRatio: 1,\n        tileSources: this.props.deepZoom,\n\n        gestureSettingsTouch: {\n          scrolltozoom: false,\n          clicktozoom: true,\n          pinchtozoom: true,\n          flickenabled: true,\n          flickminspeed: 20,\n          flickmomentum: 0.4,\n        },\n      })\n      document.addEventListener(KEYBOARD_EVENT, this.handleKeyPress)\n      this.setState({\n        viewer,\n      })\n    })\n  }\n\n  onSliderChanged = event => {\n    this.state.viewer.viewport.zoomTo(event.target.value)\n  }\n\n  onZoomChanged = () => {\n    if (!this.state.viewer) return\n    this.setState({\n      slider: {\n        ...this.state.slider,\n        min: this.state.viewer.viewport.getMinZoom(),\n        max: this.state.viewer.viewport.getMaxZoom(),\n        value: this.state.viewer.viewport.getZoom(),\n      },\n    })\n  }\n\n  componentDidMount() {\n    const element = document.getElementById(this.props.lightboxId)\n    if (element) {\n      this.setState({\n        element,\n        // FIXME: convert to import('openseadragon) once force supports it\n        promisedDragon: Promise.resolve(require(\"openseadragon\")),\n      })\n    }\n  }\n\n  componentWillUnmount() {\n    this.hide()\n  }\n\n  componentDidUpdate(_prevProps, prevState) {\n    if (this.state.shown === true && prevState.shown === false) {\n      this.initSeaDragon()\n    }\n    if (this.state.viewer && !prevState.viewer) {\n      this.postRender()\n    }\n  }\n\n  renderLightbox() {\n    const { slider } = this.state\n    return (\n      <FadeTransition\n        in={this.state.shown}\n        mountOnEnter\n        unmountOnExit\n        timeout={{ enter: 250, exit: 300 }}\n      >\n        <DeepZoomContainer\n          onMouseMove={this.detectActivity}\n          onWheel={this.detectActivity}\n          onTouchStart={this.detectActivity}\n          onTouchMove={this.detectActivity}\n          ref={this.state.deepZoomRef as any /* TODO Update SC */}\n        >\n          <Box\n            position=\"absolute\"\n            top={space(3) / 2}\n            right={space(3) / 2}\n            zIndex={1001}\n          >\n            <CloseButton onClick={() => this.hide()} />\n          </Box>\n          <Flex\n            position=\"absolute\"\n            width=\"100%\"\n            justifyContent=\"center\"\n            zIndex={1001}\n            bottom={space(2)}\n          >\n            <FadeTransition\n              in={this.state.showZoomSlider}\n              timeout={{ enter: 50, exit: 150 }}\n            >\n              <Slider\n                min={slider.min}\n                max={slider.max}\n                step={slider.step}\n                value={slider.value}\n                onChange={this.onSliderChanged}\n                onZoomInClicked={() => this.zoomIn()}\n                onZoomOutClicked={() => this.zoomOut()}\n              />\n            </FadeTransition>\n          </Flex>\n        </DeepZoomContainer>\n      </FadeTransition>\n    )\n  }\n\n  renderPortal = () => {\n    return this.state.element\n      ? ReactDOM.createPortal(this.renderLightbox(), this.state.element)\n      : null\n  }\n\n  render() {\n    const {\n      enabled,\n      isDefault,\n      imageAlt,\n      src,\n      initialHeight,\n      user,\n    } = this.props\n    const height = initialHeight || \"auto\"\n    const isAdmin = userIsAdmin(user)\n\n    // Only render client-side\n    if (!this.state.element) {\n      return (\n        <Flex justifyContent=\"center\" height={height} alignItems=\"center\">\n          <StyledImage\n            style={{ cursor: enabled ? \"zoom-in\" : \"auto\" }}\n            alt={imageAlt}\n            src={src}\n            preventRightClick\n          />\n        </Flex>\n      )\n    }\n\n    return (\n      <>\n        {this.renderPortal()}\n        <Flex\n          justifyContent=\"center\"\n          alignItems=\"center\"\n          height={height}\n          onClick={enabled ? this.show.bind(this) : null}\n        >\n          <StyledImage\n            style={{ cursor: enabled ? \"zoom-in\" : \"auto\" }}\n            src={src}\n            alt={imageAlt}\n            data-type=\"artwork-image\"\n            data-is-default={isDefault}\n            preventRightClick={!isAdmin}\n          />\n        </Flex>\n      </>\n    )\n  }\n\n  postRender = () => {\n    this.state.viewer.addHandler(\n      \"zoom\",\n      bind(throttle(this.onZoomChanged, 50), this)\n    )\n    this.state.viewer.addHandler(\n      \"tile-drawn\",\n      once(() => {\n        this.setState({\n          slider: {\n            ...this.state.slider,\n            min: this.state.viewer.viewport.getMinZoom(),\n            max: this.state.viewer.viewport.getMaxZoom(),\n            value: this.state.viewer.viewport.getHomeZoom(),\n          },\n        })\n      })\n    )\n    this.detectActivity()\n  }\n}\n\nexport const Lightbox = withSystemContext(LightboxComponent)\n"],"file":"Lightbox.js"}