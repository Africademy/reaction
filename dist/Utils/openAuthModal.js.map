{"version":3,"sources":["../../src/Utils/openAuthModal.ts"],"names":["AuthModalIntent","openAuthModal","mediator","reason","handled","sd","IS_MOBILE","intent","getMobileAuthIntent","openMobileAuth","getDesktopAuthIntent","openDesktopAuth","window","location","href","params","trigger","FollowArtist","getMobileIntentToFollowArtist","FollowPartner","getMobileIntentToFollowPartner","SaveArtwork","getMobileIntentToSaveArtwork","undefined","contextModule","entity","action","kind","objectId","id","signUpIntent","entityName","name","getDesktopIntentToFollowArtist","getDesktopIntentToFollowPartner","getDesktopIntentToSaveArtwork","mode","copy","signupIntent","afterSignUpAction"],"mappings":"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","sourcesContent":["import * as Schema from \"Artsy/Analytics/Schema\"\nimport { Mediator } from \"Artsy/SystemContext\"\nimport { stringify } from \"qs\"\nimport { data as sd } from \"sharify\"\n\ninterface AuthReason {\n  entity: {\n    id: string\n    name: string\n  }\n  contextModule: Schema.ContextModule\n  intent: AuthModalIntent\n}\n\nexport enum AuthModalIntent {\n  FollowArtist = \"FollowArtist\",\n  FollowPartner = \"FollowPartner\",\n  SaveArtwork = \"SaveArtwork\",\n}\n\nexport const openAuthModal = (mediator: Mediator, reason: AuthReason) => {\n  let handled = false\n\n  if (sd.IS_MOBILE) {\n    const intent = getMobileAuthIntent(reason)\n    if (intent) {\n      openMobileAuth(intent)\n      handled = true\n    }\n  } else if (mediator) {\n    const intent = getDesktopAuthIntent(reason)\n    if (intent) {\n      openDesktopAuth(mediator, intent)\n      handled = true\n    }\n  }\n\n  if (!handled) {\n    window.location.href = \"/login\"\n  }\n}\n\nfunction openMobileAuth(intent) {\n  const params = stringify(intent)\n  const href = `/sign_up?redirect-to=${window.location}&${params}`\n\n  window.location.href = href\n}\n\nfunction openDesktopAuth(mediator, intent) {\n  mediator.trigger(\"open:auth\", intent)\n}\n\ninterface MobileIntent {\n  action: string\n  contextModule: Schema.ContextModule | string\n  intent: string\n  kind: string\n  objectId: string\n  signUpIntent: string\n  trigger: string\n  entityName: string\n}\n\nfunction getMobileAuthIntent(reason: AuthReason): MobileIntent {\n  switch (reason.intent) {\n    case AuthModalIntent.FollowArtist:\n      return getMobileIntentToFollowArtist(reason)\n    case AuthModalIntent.FollowPartner:\n      return getMobileIntentToFollowPartner(reason)\n    case AuthModalIntent.SaveArtwork:\n      return getMobileIntentToSaveArtwork(reason)\n    default:\n      return undefined\n  }\n}\n\nfunction getMobileIntentToFollowArtist({\n  contextModule,\n  entity,\n}: AuthReason): MobileIntent {\n  return {\n    action: \"follow\",\n    contextModule,\n    intent: \"follow artist\",\n    kind: \"artist\",\n    objectId: entity.id,\n    signUpIntent: \"follow artist\",\n    trigger: \"click\",\n    entityName: entity.name,\n  }\n}\n\nfunction getMobileIntentToFollowPartner({\n  contextModule,\n  entity,\n}: AuthReason): MobileIntent {\n  return {\n    action: \"follow\",\n    contextModule,\n    intent: \"follow partner\",\n    kind: \"gallery\",\n    objectId: entity.id,\n    signUpIntent: \"follow partner\",\n    trigger: \"click\",\n    entityName: entity.name,\n  }\n}\n\nfunction getMobileIntentToSaveArtwork({\n  contextModule,\n  entity,\n}: AuthReason): MobileIntent {\n  return {\n    action: \"save\",\n    contextModule,\n    intent: \"save artwork\",\n    kind: \"artwork\",\n    objectId: entity.id,\n    signUpIntent: \"save artwork\",\n    trigger: \"click\",\n    entityName: entity.name,\n  }\n}\n\ninterface DesktopIntent {\n  mode: string\n  copy: string\n  intent?: string\n  signupIntent: string\n  trigger?: string\n  afterSignUpAction: {\n    kind?: string\n    action: string\n    objectId: string\n  }\n}\n\nfunction getDesktopAuthIntent(reason: AuthReason): DesktopIntent {\n  switch (reason.intent) {\n    case AuthModalIntent.FollowArtist:\n      return getDesktopIntentToFollowArtist(reason)\n    case AuthModalIntent.FollowPartner:\n      return getDesktopIntentToFollowPartner(reason)\n    case AuthModalIntent.SaveArtwork:\n      return getDesktopIntentToSaveArtwork(reason)\n    default:\n      return undefined\n  }\n}\n\nfunction getDesktopIntentToFollowArtist({ entity }: AuthReason): DesktopIntent {\n  return {\n    mode: \"signup\",\n    copy: `Sign up to follow ${entity.name}`,\n    signupIntent: \"follow artist\",\n    afterSignUpAction: {\n      kind: \"artist\",\n      action: \"follow\",\n      objectId: entity.id,\n    },\n  }\n}\n\nfunction getDesktopIntentToFollowPartner({\n  entity,\n}: AuthReason): DesktopIntent {\n  return {\n    mode: \"signup\",\n    copy: `Sign up to follow ${entity.name}`,\n    signupIntent: \"follow partner\",\n    afterSignUpAction: {\n      kind: \"profile\", // should this be \"partner\"?\n      action: \"follow\",\n      objectId: entity.id,\n    },\n  }\n}\n\nfunction getDesktopIntentToSaveArtwork({ entity }: AuthReason): DesktopIntent {\n  return {\n    mode: \"signup\",\n    copy: `Sign up to save artworks`,\n    intent: \"save artwork\",\n    signupIntent: \"save artwork\",\n    trigger: \"click\",\n    afterSignUpAction: {\n      action: \"save\",\n      objectId: entity.id,\n    },\n  }\n}\n"],"file":"openAuthModal.js"}