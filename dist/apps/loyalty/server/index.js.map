{"version":3,"sources":["apps/loyalty/server/index.js","../src/apps/loyalty/server/index.tsx"],"names":["bodyParser","require","cookieParser","express","session","path","React","server_1","styleSheet","template_1","inquiries_1","login_1","current_user_1","app","artsyPassport","use","static","resolve","__dirname","json","urlencoded","extended","secret","process","env","ARTSY_SECRET","cookie","Object","assign","CurrentUser","default","loginPagePath","options","facebookPath","twitterPath","get","req","res","redirect","baseUrl","formConfig","url","csrfToken","html","renderToString","createElement","form","styles","rules","map","rule","cssText","join","send","entrypoint","user","defineProperty","exports","value"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\nconst bodyParser = require(\"body-parser\");\nconst cookieParser = require(\"cookie-parser\");\nconst express = require(\"express\");\nconst session = require(\"express-session\");\nconst path = require(\"path\");\nconst React = require(\"react\");\nconst server_1 = require(\"react-dom/server\");\nconst styleSheet = require(\"styled-components/lib/models/StyleSheet\");\nconst template_1 = require(\"./template\");\nconst inquiries_1 = require(\"../containers/inquiries\");\nconst login_1 = require(\"../containers/login\");\nconst current_user_1 = require(\"./current_user\");\nconst app = express();\nconst artsyPassport = require(\"artsy-passport\");\napp.use(express.static(path.resolve(__dirname)));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(cookieParser());\napp.use(session({\n    secret: process.env.ARTSY_SECRET,\n    cookie: {},\n}));\napp.use(artsyPassport(Object.assign({}, process.env, {\n    CurrentUser: current_user_1.default,\n    loginPagePath: \"/login\",\n})));\nconst { loginPagePath, facebookPath, twitterPath, } = artsyPassport.options;\napp.get(\"/\", (req, res) => {\n    res.redirect(req.baseUrl + \"/inquiries\");\n});\napp.get(loginPagePath, (req, res) => {\n    const formConfig = {\n        url: req.baseUrl + req.path,\n        csrfToken: req.csrfToken(),\n        facebookPath,\n        twitterPath,\n    };\n    const html = server_1.renderToString(React.createElement(login_1.default, { form: formConfig }));\n    const styles = styleSheet.rules().map(rule => rule.cssText).join(\"\\n\");\n    res.send(template_1.default({\n        styles,\n        html,\n        entrypoint: \"/bundles/login.js\",\n    }));\n});\napp.get(\"/inquiries\", (req, res) => {\n    if (!req.user) {\n        return res.redirect(req.baseUrl + \"/login\");\n    }\n    const html = server_1.renderToString(React.createElement(inquiries_1.default, null));\n    const styles = styleSheet.rules().map(rule => rule.cssText).join(\"\\n\");\n    res.send(template_1.default({\n        styles,\n        html,\n        entrypoint: \"/bundles/inquiries.js\",\n    }));\n});\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = app;\n","import * as bodyParser from \"body-parser\"\nimport * as cookieParser from \"cookie-parser\"\nimport * as csurf from \"csurf\"\nimport * as express from \"express\"\nimport * as session from \"express-session\"\nimport * as path from \"path\"\nimport * as React from \"react\"\nimport { renderToString } from \"react-dom/server\"\nimport * as styleSheet from \"styled-components/lib/models/StyleSheet\"\nimport renderPage from \"./template\"\n\nimport Inquiries from \"../containers/inquiries\"\nimport Login from \"../containers/login\"\nimport CurrentUser from \"./current_user\"\n\nconst app = express()\nconst artsyPassport = require(\"artsy-passport\")\n\napp.use(express.static(path.resolve(__dirname)))\n\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({extended: true}))\napp.use(cookieParser())\napp.use(session({\n  secret: process.env.ARTSY_SECRET,\n  cookie: {},\n}))\napp.use(artsyPassport(Object.assign({}, process.env, {\n  CurrentUser,\n  loginPagePath: \"/login\",\n})))\n\nconst {\n  loginPagePath,\n  facebookPath,\n  twitterPath,\n} = artsyPassport.options\n\napp.get(\"/\", (req, res) => {\n  res.redirect(req.baseUrl + \"/inquiries\")\n})\n\napp.get(loginPagePath, (req, res) => {\n  const formConfig = {\n    url: req.baseUrl + req.path,\n    csrfToken: req.csrfToken(),\n    facebookPath,\n    twitterPath,\n  }\n  const html = renderToString(<Login form={formConfig} />)\n  const styles = styleSheet.rules().map(rule => rule.cssText).join(\"\\n\")\n\n  res.send(renderPage({\n    styles,\n    html,\n    entrypoint: \"/bundles/login.js\",\n  }))\n})\n\napp.get(\"/inquiries\", (req, res) => {\n  if (!req.user) {\n    return res.redirect(req.baseUrl + \"/login\")\n  }\n\n  const html = renderToString(<Inquiries />)\n  const styles = styleSheet.rules().map(rule => rule.cssText).join(\"\\n\")\n  res.send(renderPage({\n    styles,\n    html,\n    entrypoint: \"/bundles/inquiries.js\",\n  }))\n})\n\nexport default app\n"]}